webpackJsonp([39,113],{1226:function(s,a){s.exports={content:'<style>.transformer-react-render{border:1px dashed #959da5;border-radius:5px;display:block}.transformer-react-render-container>pre{max-height:400px;transition:all .2s ease}.transformer-react-render-container>pre.focused{max-height:none;box-shadow:0 0 6px rgba(0,0,0,.2)}</style><h2 id=情景重现><a href=#%E6%83%85%E6%99%AF%E9%87%8D%E7%8E%B0 aria-hidden=true><span class="icon icon-link"></span></a>情景重现</h2><p>前几天接了个私活，主要是修改一些前端页面样式和优化 html 结构等。</p><p>其中 css/js 引入方式为 umd（Universal Module Definition） ，也就是直接用<code>script/link</code>引入。而不是<code>requirejs/seajs/webpack</code> 对应的 <code>amd/cmd/commonjs</code> 加载 javascript 或样式。</p><p>在不断地 修改样式 -> 刷新页面的循环中，时间浪费了许多！</p><p>于是萌生出：“造一个热更新服务的轮子”。</p><p>注意：<em>该工具只支持热更新 umd 引入的依赖</em></p><h2 id=原理><a href=#%E5%8E%9F%E7%90%86 aria-hidden=true><span class="icon icon-link"></span></a>原理</h2><img src=false width=576 height=338 data-src=https://ooo.0o0.ooo/2017/04/03/58e25ac7f17eb.jpg><p>如图，首先需要建立一个 http(s) 服务，通过该服务获取前端静态资源，对于 HTML 文件的请求，服务器需要额外插入一段客户端脚本。脚本的工作主要是用来建立 websocket 长连接。同时需要开启文件监听，异步监听到文件的变化，并广播 reload 消息至依赖该文件的客户端，客户端收到该消息后，便 <code>location.reload()</code> <strong>自动刷新页面</strong></p><h2 id=特性><a href=#%E7%89%B9%E6%80%A7 aria-hidden=true><span class="icon icon-link"></span></a>特性</h2><ul><li><p><strong>热更新</strong> <img src=false alt width=893 height=709 data-src=https://ooo.0o0.ooo/2017/03/31/58de5c97bfa0b.jpg></p></li><li><p><strong>远程调试</strong>（适合局域网中移动端调试） <img src=false alt width=892 height=711 data-src=https://ooo.0o0.ooo/2017/03/31/58de5c83f0eac.jpg></p></li><li><p><strong>文件视图</strong><br>访问：<code>http://localhost:8082/__hrs__/file</code> <img src=false alt width=645 height=674 data-src=https://ooo.0o0.ooo/2017/04/01/58df9961dd9b2.jpg></p></li><li><p><strong>依赖关系查看</strong></p><ol><li><p>单个文件<br>访问：<code>http://localhost:8082/index.html.hrs.map</code></p><pre><code class="hljs language-json"data-query={} data-lang=json>{\n    <span class=hljs-attr>"/Users/moyu/my-code/JavaCode/dike/js/jquery-1.9.1.js"</span>: <span class=hljs-string>"../../js/jquery-1.9.1.js"</span>,\n    <span class=hljs-attr>"/Users/moyu/my-code/JavaCode/dike/js/bootstrap.js"</span>: <span class=hljs-string>"../../js/bootstrap.js"</span>,\n    <span class=hljs-attr>"/Users/moyu/my-code/JavaCode/dike/js/navbar.js"</span>: <span class=hljs-string>"../../js/navbar.js"</span>,\n    <span class=hljs-attr>"/Users/moyu/my-code/JavaCode/dike/css/font-awesome.min.css"</span>: <span class=hljs-string>"../../css/font-awesome.min.css"</span>,\n    <span class=hljs-attr>"/Users/moyu/my-code/JavaCode/dike/css/navbar.css"</span>: <span class=hljs-string>"../../css/navbar.css"</span>,\n    <span class=hljs-attr>"/Users/moyu/my-code/JavaCode/dike/css/conceptModel.css"</span>: <span class=hljs-string>"../../css/conceptModel.css"</span>,\n    <span class=hljs-attr>"/Users/moyu/my-code/JavaCode/dike/css/dropzone/dropzone.css"</span>: <span class=hljs-string>"../../css/dropzone/dropzone.css"</span>\n}</code></pre></li><li>全局<br>访问：<code>http://localhost:8082/__hrs__/map</code></li></ol></li><li><p>转发请求（可避免跨域）<br>访问：<code>http://localhost:8082/__hrs__/forward?url=http://blog.moyuyc.xyz/head.jpg</code></p></li><li><p>配置文件<br>默认认为配置文件为：<code>hrs.config.js</code><br>比如：</p></li></ul><pre><code class="hljs language-js"data-query={} data-lang=js><span class=hljs-built_in>module</span>.exports = {\n    <span class=hljs-attr>proxy</span>: {\n        <span class=hljs-string>"/api"</span>: {\n            <span class=hljs-attr>target</span>: <span class=hljs-string>"http://www.huya.com/longdd"</span>,\n        },\n        <span class=hljs-string>"/php"</span>: {\n            <span class=hljs-attr>redirect</span>: <span class=hljs-literal>true</span>, <span class=hljs-comment>// default: true</span>\n            target: <span class=hljs-string>"http://localhost:63343/start/static"</span>,<span class=hljs-comment>//"http://localhost:6999",</span>\n            changeHost: <span class=hljs-literal>true</span>,  <span class=hljs-comment>// default: true</span>\n\n            hot: <span class=hljs-literal>true</span>, <span class=hljs-comment>// hot reload enable? default: false</span>\n            <span class=hljs-comment>// Function/RegExp: will be set root config hotRule if it is null</span>\n            hotRule: <span class=hljs-function><span class=hljs-keyword>function</span> (<span class=hljs-params>filename, request</span>) </span>{\n                <span class=hljs-comment>// console.log(request.url);</span>\n                <span class=hljs-keyword>return</span> <span class=hljs-regexp>/\\.(php)$/</span>.test(filename);\n            },\n            <span class=hljs-comment>// Function: return local file path</span>\n            mapLocal: <span class=hljs-function><span class=hljs-keyword>function</span> (<span class=hljs-params>request</span>) </span>{\n                <span class=hljs-comment>// request: Express Request Object</span>\n                <span class=hljs-comment>// console.log(\'mapLocal\', request.originalUrl, request.baseUrl, request.url);</span>\n                <span class=hljs-keyword>const</span> url = request.url.replace(<span class=hljs-regexp>/\\?[\\s\\S]*/</span>, <span class=hljs-string>\'\'</span>)\n                <span class=hljs-keyword>return</span> <span class=hljs-string>"/Users/moyu/my-code/phpCode/start/static"</span> + url;\n            },\n            <span class=hljs-comment>// Function/String: return detected directory path</span>\n            mapRoot: <span class=hljs-function><span class=hljs-keyword>function</span> (<span class=hljs-params>request</span>) </span>{\n                <span class=hljs-comment>// request: Express Request Object</span>\n                <span class=hljs-keyword>return</span> <span class=hljs-string>"/Users/moyu/my-code/phpCode/start/static"</span>;\n            }\n        },\n    },\n\n    <span class=hljs-comment>// RegExp or function (filename) {...}</span>\n    hotRule: <span class=hljs-regexp>/\\.(html|htm)$/</span>, <span class=hljs-comment>// default: /\\.(html|htm)$/</span>\n\n    setUp: <span class=hljs-function><span class=hljs-keyword>function</span> (<span class=hljs-params>app</span>) </span>{\n        <span class=hljs-comment>/* app is an express server object. */</span>\n\n        <span class=hljs-comment>// http://localhost:8082/test</span>\n        app.get(<span class=hljs-string>\'/test\'</span>, <span class=hljs-function><span class=hljs-keyword>function</span> (<span class=hljs-params>req, res</span>) </span>{\n            res.end(<span class=hljs-string>"TEST!"</span>);\n        });\n    }\n};</code></pre><ul><li>支持跨域<br>建立起 hot reload server (端口 8082) 服务后，在你需要开启热更新的 html 中手动插入</li></ul><pre><code class="hljs language-html"data-query={} data-lang=html><span class=hljs-tag>&lt;<span class=hljs-name>script</span>\n    <span class=hljs-attr>src</span>=<span class=hljs-string>"http://localhost:8082/__hrs__/client-script.js?reload=false&ampdebug=true"</span>\n    <span class=hljs-attr>hrs-local</span>=<span class=hljs-string>"/Users/moyu/fe-code/a/b/jsonp.html"</span>\n    <span class=hljs-attr>hrs-root</span>=<span class=hljs-string>"/Users/moyu/fe-code"</span>\n></span><span class=null></span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span></code></pre><pre><code data-query={} data-lang>- `hrs-local` 该文件的绝对路径\n- `hrs-root` 需要监听的文件夹的路径（默认为`hrs-local`的文件夹路径，例中为：`/Users/moyu/fe-code/a/b`）\n</code></pre><h2 id=安装使用><a href=#%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8 aria-hidden=true><span class="icon icon-link"></span></a>安装使用</h2><p>使用 nodejs 实现，需要 node 环境。</p><pre><code class="hljs language-bash"data-query={} data-lang=bash>npm install -g simple-hot-reload-server</code></pre><pre><code class="hljs language-text"data-query={} data-lang=text><span class=hljs-attribute>Usage</span>: hrs [-p port] path\n\n<span class=routeros>Options:\n\n  -v --version                <span class=hljs-builtin-name>get</span> current version.\n  -p --port                   <span class=hljs-builtin-name>set</span><span class=hljs-built_in> port </span>of server. (default: 8082)\n  -c --config                <span class=hljs-built_in> config </span>path. (default hrs.config.js)\n  -h --help                   how <span class=hljs-keyword>to</span> use it.</span></code></pre><p>最后，欢迎各位 <a href=https://github.com/moyuyc/simple-hot-reload-server>star</a>！</p>',extra:{"_image-loader_":[],_progressive_:[]}}}});
//# sourceMappingURL=say-goodbye-to-manual-refresh.js.map