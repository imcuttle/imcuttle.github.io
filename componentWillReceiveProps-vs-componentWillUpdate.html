<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/favicon.png" />
    <title> componentWillReceiveProps Vs componentWillUpdate - Grass </title>
    <link rel="stylesheet" href="/style.css">
    <style>
        #music {
            position: fixed;
            top: 10px;
            left: 10px;
        }
    </style>
</head>
<body>
<div id="root">
    <div class="wrap" data-reactroot="" data-reactid="1" data-react-checksum="-713643944"><header data-reactid="2"><a class="logo-link" href="/" data-reactid="3"><img src="/favicon.png" data-reactid="4"/></a><ul class="nav nav-list" data-reactid="5"><li class="nav-list-item" data-reactid="6"><a class="nav-list-link" href="/posts/1" data-reactid="7">Posts</a></li></ul></header><main data-reactid="8"><div class="post" data-reactid="9"><article class="post-block" data-reactid="10"><h1 class="post-title" data-reactid="11">componentWillReceiveProps Vs componentWillUpdate</h1><div class="post-info" data-reactid="12"><time datetime="2016-10-23T18:05:04+00:00" data-reactid="13">Oct 23, 2016 6:05 PM</time></div></article><div class="post-content" data-reactid="14"><article data-reactid="15"><style data-reactid="16">.transformer-react-render{border:1px dashed #959da5;border-radius:5px;display:block}.transformer-react-render-container&gt;pre{max-height:400px;transition:all .2s ease}.transformer-react-render-container&gt;pre.focused{max-height:none;box-shadow:0 0 6px rgba(0,0,0,.2)}</style><p data-reactid="17">最近在写博客主题的时候，遇到一个react的坑，遂总结一番。</p><p data-reactid="18"><code data-reactid="19">componentWillReceiveProps</code><!-- react-text: 20 --> Vs <!-- /react-text --><code data-reactid="21">componentWillUpdate</code></p><p data-reactid="22">两个方法，根据语义去理解，可以读出这样的信息：</p><p data-reactid="23"><code data-reactid="24">componentWillReceiveProps</code><!-- react-text: 25 -->会在<!-- /react-text --><code data-reactid="26">componentWillUpdate</code><!-- react-text: 27 -->之前调用，而且调用<!-- /react-text --><code data-reactid="28">componentWillUpdate</code><!-- react-text: 29 -->的条件为<!-- /react-text --><code data-reactid="30">shouldComponentUpdate</code><!-- react-text: 31 --> return true<!-- /react-text --></p><p data-reactid="32"><!-- react-text: 33 -->那么，我便想当然的，在<!-- /react-text --><code data-reactid="34">componentWillUpdate</code><!-- react-text: 35 -->方法中调用了<!-- /react-text --><code data-reactid="36">setState</code><!-- react-text: 37 -->方法，然后便觉得在<!-- /react-text --><code data-reactid="38">render</code><!-- react-text: 39 -->中的<!-- /react-text --><code data-reactid="40">state</code><!-- react-text: 41 -->就是更新后的值了.<!-- /react-text --></p><pre data-reactid="42"><code class="hljs language-js" data-query="{}" data-lang="js" data-reactid="43"><!-- react-text: 44 -->componentWillUpdate(nextProps) {
	<!-- /react-text --><span class="hljs-keyword" data-reactid="45">if</span><!-- react-text: 46 -->(<!-- /react-text --><span class="hljs-keyword" data-reactid="47">this</span><!-- react-text: 48 -->.props.a !== nextProps.a) {
		<!-- /react-text --><span class="hljs-keyword" data-reactid="49">this</span><!-- react-text: 50 -->.setState({...});
	}
}<!-- /react-text --></code></pre><p data-reactid="51"><!-- react-text: 52 -->然而，事实并非如此，调用<!-- /react-text --><code data-reactid="53">this.setState()</code><!-- react-text: 54 -->后，在<!-- /react-text --><code data-reactid="55">render()</code><!-- react-text: 56 -->中并没有改变<!-- /react-text --><code data-reactid="57">state</code><!-- react-text: 58 -->。<!-- /react-text --></p><p data-reactid="59"><a href="https://facebook.github.io/react/docs/react-component.html" data-reactid="60">官方文档</a><!-- react-text: 61 -->有下面一段话:<!-- /react-text --></p><blockquote data-reactid="62"><p data-reactid="63">componentWillUpdate() is invoked immediately before rendering when new props or state are being received. Use this as an opportunity to perform preparation before an update occurs. This method is not called for the initial render.</p><p data-reactid="64">Note that you cannot call this.setState() here. If you need to update state in response to a prop change, use componentWillReceiveProps() instead.</p></blockquote><p data-reactid="65"><!-- react-text: 66 -->这段话说的很清楚了！<!-- /react-text --><code data-reactid="67">componentWillUpdate</code><!-- react-text: 68 -->会在<!-- /react-text --><code data-reactid="69">render</code><!-- react-text: 70 -->之前时刻调用，在第一次<!-- /react-text --><code data-reactid="71">render</code><!-- react-text: 72 -->的时候不会调用。<!-- /react-text --><br data-reactid="73"/><strong data-reactid="74"><!-- react-text: 75 -->你不能在该方法中调用<!-- /react-text --><code data-reactid="76">this.setState()</code><!-- react-text: 77 -->，请用<!-- /react-text --><code data-reactid="78">componentWillReceiveProps()</code><!-- react-text: 79 -->代替<!-- /react-text --></strong></p><p data-reactid="80">那么为什么会这样呢？</p><p data-reactid="81"><!-- react-text: 82 -->其实，<!-- /react-text --><a href="https://facebook.github.io/react/docs/react-component.html#setstate" data-reactid="83"><code data-reactid="84">this.setState()</code></a><!-- react-text: 85 -->不是同步方法<!-- /react-text --><br data-reactid="86"/><code data-reactid="87">setState(nextState, callback)</code><!-- react-text: 88 -->后面会带有回调函数，如果你将上诉代码做些修改：<!-- /react-text --></p><pre data-reactid="89"><code class="hljs language-js" data-query="{}" data-lang="js" data-reactid="90"><!-- react-text: 91 -->componentWillUpdate(nextProps) {
	<!-- /react-text --><span class="hljs-keyword" data-reactid="92">if</span><!-- react-text: 93 -->(<!-- /react-text --><span class="hljs-keyword" data-reactid="94">this</span><!-- react-text: 95 -->.props.a !== nextProps.a) {
		<!-- /react-text --><span class="hljs-keyword" data-reactid="96">this</span><!-- react-text: 97 -->.setState({...}, <!-- /react-text --><span class="hljs-function" data-reactid="98"><span class="hljs-keyword" data-reactid="99">function</span><!-- react-text: 100 -->(<!-- /react-text --><span class="hljs-params" data-reactid="101"></span><!-- react-text: 102 -->) <!-- /react-text --></span><!-- react-text: 103 -->{
			alert(<!-- /react-text --><span class="hljs-string" data-reactid="104">&#x27;state Updated&#x27;</span><!-- react-text: 105 -->);
		});
	}
}<!-- /react-text --></code></pre><p data-reactid="106"><!-- react-text: 107 -->你就会发现，在<!-- /react-text --><code data-reactid="108">render()</code><!-- react-text: 109 -->结束后，才会<!-- /react-text --><code data-reactid="110">alert()</code></p><p data-reactid="111"><!-- react-text: 112 -->那么，为什么<!-- /react-text --><code data-reactid="113">react</code><!-- react-text: 114 -->将<!-- /react-text --><code data-reactid="115">this.setState()</code><!-- react-text: 116 -->设计为非同步方法呢？<!-- /react-text --><br data-reactid="117"/><a href="http://stackoverflow.com/questions/36085726/setstate-in-reactjs-is-async-or-sync" data-reactid="118">网上的解释</a><!-- react-text: 119 -->为:<!-- /react-text --></p><blockquote data-reactid="120"><p data-reactid="121">setState() does not immediately mutate this.state but creates a pending state transition. Accessing this.state after calling this method can potentially return the existing value. There is no guarantee of synchronous operation of calls to setState and calls may be batched for performance gains.</p><p data-reactid="122">This is because setState alters the state and causes rerendering. This can be an expensive operation and making it synchronous might leave the browser unresponsive. Thus the setState calls are asynchronous as well as batched for better UI experience and performance.</p></blockquote><p data-reactid="123">完.</p></article></div><div class="gitment-container" data-reactid="124"></div><div class="paginator" data-reactid="125"><a title="再也不是“单纯”学生" class="prev" href="/never-simple-student" data-reactid="126">Prev</a><a title="LinuxC OSX sendfile()" class="next" href="/linux-c-osx-sendfile" data-reactid="127">Next</a></div></div></main><footer data-reactid="128"><div class="copyright" data-reactid="129"><p data-reactid="130"><!-- react-text: 131 -->© 2017. Powered By <!-- /react-text --><a href="https://github.com/picidaejs/picidae" data-reactid="132">Picidae</a></p></div></footer></div>
</div>
<audio id="music" controls autoplay src="http://www.170mv.com/kw/other.web.ri01.sycdn.kuwo.cn/resource/n3/25/67/3891786006.mp3"></audio>
<script>
  !function () {
    var a = document.getElementById("music")
    a && (a.volume = 1)
  }()
</script>
<script src="/PICIDAE_COMMON.js"></script>
<script src="/PICIDAE_ENTRY.js"></script>
</body>
</html>
