<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/favicon.png" />
    <title> HTML5 富文本编辑！ - Grass </title>
    <link rel="stylesheet" href="/style.css">
    <style>
        #music {
            position: fixed;
            top: 10px;
            left: 10px;
        }
    </style>
</head>
<body>
<div id="root">
    <div class="wrap" data-reactroot="" data-reactid="1" data-react-checksum="-1693330722"><header data-reactid="2"><a class="logo-link" href="/" data-reactid="3"><img src="/favicon.png" data-reactid="4"/></a><ul class="nav nav-list" data-reactid="5"><li class="nav-list-item" data-reactid="6"><a class="nav-list-link" href="/posts/1" data-reactid="7">Posts</a></li></ul></header><main data-reactid="8"><div class="post" data-reactid="9"><article class="post-block" data-reactid="10"><h1 class="post-title" data-reactid="11">HTML5 富文本编辑！</h1><div class="post-info" data-reactid="12"><time datetime="2017-11-05T21:00:58+00:00" data-reactid="13">Nov 5, 2017 9:00 PM</time></div></article><div class="post-content" data-reactid="14"><article data-reactid="15"><style data-reactid="16">.transformer-react-render{border:1px dashed #959da5;border-radius:5px;display:block}.transformer-react-render-container&gt;pre{max-height:400px;transition:all .2s ease}.transformer-react-render-container&gt;pre.focused{max-height:none;box-shadow:0 0 6px rgba(0,0,0,.2)}</style><h2 id="首先看一个实例！" data-reactid="17"><a href="#%E9%A6%96%E5%85%88%E7%9C%8B%E4%B8%80%E4%B8%AA%E5%AE%9E%E4%BE%8B%EF%BC%81" aria-hidden="true" data-reactid="18"><span class="icon icon-link" data-reactid="19"></span></a><!-- react-text: 20 -->首先看一个实例！<!-- /react-text --></h2><p data-reactid="21"><a href="https://github.com/m-cuttlefish/react-code-editor" data-reactid="22"><code data-reactid="23">react-code-editor</code></a><br data-reactid="24"/><!-- react-text: 25 -->如下代码：<!-- /react-text --></p><pre data-reactid="26"><code class="hljs language-css" data-query="{}" data-lang="css" data-reactid="27"><span class="hljs-selector-class" data-reactid="28">.stage</span><!-- react-text: 29 --> {
  <!-- /react-text --><span class="hljs-attribute" data-reactid="30">border</span><!-- react-text: 31 -->: <!-- /react-text --><span class="hljs-number" data-reactid="32">1px</span><!-- react-text: 33 --> dashed <!-- /react-text --><span class="hljs-number" data-reactid="34">#333</span><!-- react-text: 35 -->;
  <!-- /react-text --><span class="hljs-attribute" data-reactid="36">padding</span><!-- react-text: 37 -->: <!-- /react-text --><span class="hljs-number" data-reactid="38">10px</span><!-- react-text: 39 -->;  
}<!-- /react-text --></code></pre><div class="transformer-react-render-container" data-reactid="40"><pre data-reactid="41"><code spellcheck="true" contenteditable="true" class="code-editor hljs language-jsx" data-reactid="42"></code></pre><div data-id="0" class="transformer-react-render" data-reactid="43"><div class="stage" data-reactid="44"><h4 style="margin:0;" data-reactid="45">CodeEditor</h4><pre data-reactid="46"><code spellcheck="false" contenteditable="true" class="code-editor hljs javascript" data-reactid="47"></code></pre><pre data-reactid="48"><code spellcheck="false" contenteditable="true" class="code-editor hljs javascript" data-reactid="49"></code></pre></div></div></div><h2 id="section--range" data-reactid="50"><a href="#section--range" aria-hidden="true" data-reactid="51"><span class="icon icon-link" data-reactid="52"></span></a><!-- react-text: 53 -->Section / Range<!-- /react-text --></h2><pre data-reactid="54"><code class="hljs language-html" data-query="{}" data-lang="__html" data-reactid="55"><span class="hljs-tag" data-reactid="56"><!-- react-text: 57 -->&lt;<!-- /react-text --><span class="hljs-name" data-reactid="58">div</span><!-- react-text: 59 --> <!-- /react-text --><span class="hljs-attr" data-reactid="60">class</span><!-- react-text: 61 -->=<!-- /react-text --><span class="hljs-string" data-reactid="62">&quot;stage&quot;</span><!-- react-text: 63 -->&gt;<!-- /react-text --></span><!-- react-text: 64 -->
    <!-- /react-text --><span class="hljs-tag" data-reactid="65"><!-- react-text: 66 -->&lt;<!-- /react-text --><span class="hljs-name" data-reactid="67">pre</span><!-- react-text: 68 --> <!-- /react-text --><span class="hljs-attr" data-reactid="69">id</span><!-- react-text: 70 -->=<!-- /react-text --><span class="hljs-string" data-reactid="71">&quot;dom-editable&quot;</span><!-- react-text: 72 --> <!-- /react-text --><span class="hljs-attr" data-reactid="73">contenteditable</span><!-- react-text: 74 -->=<!-- /react-text --><span class="hljs-string" data-reactid="75">&quot;true&quot;</span><!-- react-text: 76 -->&gt;<!-- /react-text --></span><!-- react-text: 77 -->Input Here.
Second Line.
<!-- /react-text --><span class="hljs-tag" data-reactid="78"><!-- react-text: 79 -->&lt;/<!-- /react-text --><span class="hljs-name" data-reactid="80">pre</span><!-- react-text: 81 -->&gt;<!-- /react-text --></span><!-- react-text: 82 -->
    <!-- /react-text --><span class="hljs-tag" data-reactid="83"><!-- react-text: 84 -->&lt;<!-- /react-text --><span class="hljs-name" data-reactid="85">button</span><!-- react-text: 86 --> <!-- /react-text --><span class="hljs-attr" data-reactid="87">id</span><!-- react-text: 88 -->=<!-- /react-text --><span class="hljs-string" data-reactid="89">&quot;btn-1&quot;</span><!-- react-text: 90 -->&gt;<!-- /react-text --></span><!-- react-text: 91 -->Select Second line<!-- /react-text --><span class="hljs-tag" data-reactid="92"><!-- react-text: 93 -->&lt;/<!-- /react-text --><span class="hljs-name" data-reactid="94">button</span><!-- react-text: 95 -->&gt;<!-- /react-text --></span><!-- react-text: 96 -->
<!-- /react-text --><span class="hljs-tag" data-reactid="97"><!-- react-text: 98 -->&lt;/<!-- /react-text --><span class="hljs-name" data-reactid="99">div</span><!-- react-text: 100 -->&gt;<!-- /react-text --></span><!-- react-text: 101 -->

<!-- /react-text --><span class="hljs-tag" data-reactid="102"><!-- react-text: 103 -->&lt;<!-- /react-text --><span class="hljs-name" data-reactid="104">script</span><!-- react-text: 105 --> <!-- /react-text --><span class="hljs-attr" data-reactid="106">type</span><!-- react-text: 107 -->=<!-- /react-text --><span class="hljs-string" data-reactid="108">&quot;text/javascript&quot;</span><!-- react-text: 109 -->&gt;<!-- /react-text --></span><span class="javascript" data-reactid="110"><!-- react-text: 111 -->
    <!-- /react-text --><span class="hljs-function" data-reactid="112"><span class="hljs-keyword" data-reactid="113">function</span><!-- react-text: 114 --> <!-- /react-text --><span class="hljs-title" data-reactid="115">selectionHelper</span><!-- react-text: 116 -->(<!-- /react-text --><span class="hljs-params" data-reactid="117">el, pos</span><!-- react-text: 118 -->) <!-- /react-text --></span><!-- react-text: 119 -->{
        <!-- /react-text --><span class="hljs-keyword" data-reactid="120">var</span><!-- react-text: 121 --> indexes = {}
        <!-- /react-text --><span class="hljs-comment" data-reactid="122">// getSelection</span><!-- react-text: 123 -->
        <!-- /react-text --><span class="hljs-keyword" data-reactid="124">if</span><!-- react-text: 125 --> (<!-- /react-text --><span class="hljs-keyword" data-reactid="126">typeof</span><!-- react-text: 127 --> pos === <!-- /react-text --><span class="hljs-string" data-reactid="128">&#x27;undefined&#x27;</span><!-- react-text: 129 -->) {
            <!-- /react-text --><span class="hljs-keyword" data-reactid="130">var</span><!-- react-text: 131 --> selection = <!-- /react-text --><span class="hljs-built_in" data-reactid="132">window</span><!-- react-text: 133 -->.getSelection()
            <!-- /react-text --><span class="hljs-keyword" data-reactid="134">var</span><!-- react-text: 135 --> range = selection.getRangeAt(<!-- /react-text --><span class="hljs-number" data-reactid="136">0</span><!-- react-text: 137 -->);
            <!-- /react-text --><span class="hljs-keyword" data-reactid="138">var</span><!-- react-text: 139 --> clone = range.cloneRange();

            clone.selectNodeContents(el);
            clone.setEnd(range.endContainer, range.endOffset);
            indexes.end = clone.toString().length;
            clone.setStart(range.startContainer, range.startOffset);
            indexes.start = indexes.end - clone.toString().length;
            indexes.atStart = clone.startOffset === <!-- /react-text --><span class="hljs-number" data-reactid="140">0</span><!-- react-text: 141 -->;
            indexes.commonAncestorContainer = clone.commonAncestorContainer;
            indexes.endContainer = clone.endContainer;
            indexes.startContainer = clone.startContainer;

            <!-- /react-text --><span class="hljs-keyword" data-reactid="142">return</span><!-- react-text: 143 --> indexes;
        }

        <!-- /react-text --><span class="hljs-keyword" data-reactid="144">var</span><!-- react-text: 145 --> setSelection = pos.end &amp;&amp; pos.end !== pos.start;
        <!-- /react-text --><span class="hljs-keyword" data-reactid="146">var</span><!-- react-text: 147 --> length = <!-- /react-text --><span class="hljs-number" data-reactid="148">0</span><!-- react-text: 149 -->;
        <!-- /react-text --><span class="hljs-keyword" data-reactid="150">var</span><!-- react-text: 151 --> range = <!-- /react-text --><span class="hljs-built_in" data-reactid="152">document</span><!-- react-text: 153 -->.createRange();
        <!-- /react-text --><span class="hljs-keyword" data-reactid="154">var</span><!-- react-text: 155 --> next;
        <!-- /react-text --><span class="hljs-keyword" data-reactid="156">var</span><!-- react-text: 157 --> startindex;
        <!-- /react-text --><span class="hljs-keyword" data-reactid="158">var</span><!-- react-text: 159 --> start = pos.start &gt; el.textContent.length ? el.textContent.length : pos.start;
        <!-- /react-text --><span class="hljs-keyword" data-reactid="160">var</span><!-- react-text: 161 --> end = pos.end &gt; el.textContent.length ? el.textContent.length : pos.end;
        <!-- /react-text --><span class="hljs-keyword" data-reactid="162">var</span><!-- react-text: 163 --> atStart = pos.atStart;


        <!-- /react-text --><span class="hljs-keyword" data-reactid="164">for</span><!-- react-text: 165 --> (<!-- /react-text --><span class="hljs-keyword" data-reactid="166">var</span><!-- react-text: 167 --> i = <!-- /react-text --><span class="hljs-number" data-reactid="168">0</span><!-- react-text: 169 -->; i &lt; el.childNodes.length; i++) {
            next = el.childNodes[i]
            <!-- /react-text --><span class="hljs-keyword" data-reactid="170">if</span><!-- react-text: 171 --> (next.nodeType === Node.TEXT_NODE) {
                <!-- /react-text --><span class="hljs-keyword" data-reactid="172">var</span><!-- react-text: 173 --> olen = length;
                length += next.textContent.length;

                <!-- /react-text --><span class="hljs-comment" data-reactid="174">// Set start point of selection</span><!-- react-text: 175 -->
                <!-- /react-text --><span class="hljs-keyword" data-reactid="176">var</span><!-- react-text: 177 --> atLength = atStart ? length &gt; start : length &gt;= start;
                <!-- /react-text --><span class="hljs-keyword" data-reactid="178">if</span><!-- react-text: 179 --> (!startindex &amp;&amp; atLength) {
                    startindex = <!-- /react-text --><span class="hljs-literal" data-reactid="180">true</span><!-- react-text: 181 -->;
                    range.setStart(next, start - olen);
                    <!-- /react-text --><span class="hljs-keyword" data-reactid="182">if</span><!-- react-text: 183 --> (!setSelection) {
                        range.collapse(<!-- /react-text --><span class="hljs-literal" data-reactid="184">true</span><!-- react-text: 185 -->);
                        makeSelection(el, range);
                        <!-- /react-text --><span class="hljs-keyword" data-reactid="186">break</span><!-- react-text: 187 -->;
                    }
                }

                <!-- /react-text --><span class="hljs-comment" data-reactid="188">// Set end point of selection</span><!-- react-text: 189 -->
                <!-- /react-text --><span class="hljs-keyword" data-reactid="190">if</span><!-- react-text: 191 --> (setSelection &amp;&amp; length &gt;= end) {
                    range.setEnd(next, end - olen);
                    makeSelection(el, range);
                    <!-- /react-text --><span class="hljs-keyword" data-reactid="192">break</span><!-- react-text: 193 -->;
                }
            }
        }

        <!-- /react-text --><span class="hljs-function" data-reactid="194"><span class="hljs-keyword" data-reactid="195">function</span><!-- react-text: 196 --> <!-- /react-text --><span class="hljs-title" data-reactid="197">makeSelection</span><!-- react-text: 198 -->(<!-- /react-text --><span class="hljs-params" data-reactid="199">el, range</span><!-- react-text: 200 -->) <!-- /react-text --></span><!-- react-text: 201 -->{
            <!-- /react-text --><span class="hljs-keyword" data-reactid="202">var</span><!-- react-text: 203 --> selection = <!-- /react-text --><span class="hljs-built_in" data-reactid="204">window</span><!-- react-text: 205 -->.getSelection();
            el.focus();
            selection.removeAllRanges();
            selection.addRange(range);
        }
    }

    <!-- /react-text --><span class="hljs-keyword" data-reactid="206">var</span><!-- react-text: 207 --> dom = <!-- /react-text --><span class="hljs-built_in" data-reactid="208">document</span><!-- react-text: 209 -->.getElementById(<!-- /react-text --><span class="hljs-string" data-reactid="210">&#x27;dom-editable&#x27;</span><!-- react-text: 211 -->);
    dom.addEventListener(<!-- /react-text --><span class="hljs-string" data-reactid="212">&#x27;keyup&#x27;</span><!-- react-text: 213 -->, <!-- /react-text --><span class="hljs-function" data-reactid="214"><span class="hljs-keyword" data-reactid="215">function</span><!-- react-text: 216 --> (<!-- /react-text --><span class="hljs-params" data-reactid="217">evt</span><!-- react-text: 218 -->) <!-- /react-text --></span><!-- react-text: 219 -->{
        <!-- /react-text --><span class="hljs-built_in" data-reactid="220">console</span><!-- react-text: 221 -->.log(selectionHelper(dom))
    });

    dom.addEventListener(<!-- /react-text --><span class="hljs-string" data-reactid="222">&#x27;keydown&#x27;</span><!-- react-text: 223 -->, <!-- /react-text --><span class="hljs-function" data-reactid="224"><span class="hljs-keyword" data-reactid="225">function</span><!-- react-text: 226 --> (<!-- /react-text --><span class="hljs-params" data-reactid="227">evt</span><!-- react-text: 228 -->) <!-- /react-text --></span><!-- react-text: 229 -->{
        <!-- /react-text --><span class="hljs-keyword" data-reactid="230">if</span><!-- react-text: 231 --> (evt.keyCode === <!-- /react-text --><span class="hljs-number" data-reactid="232">13</span><!-- react-text: 233 -->) {
            <!-- /react-text --><span class="hljs-built_in" data-reactid="234">document</span><!-- react-text: 235 -->.execCommand(<!-- /react-text --><span class="hljs-string" data-reactid="236">&#x27;insertHTML&#x27;</span><!-- react-text: 237 -->, <!-- /react-text --><span class="hljs-literal" data-reactid="238">false</span><!-- react-text: 239 -->, <!-- /react-text --><span class="hljs-string" data-reactid="240">&#x27;\n&#x27;</span><!-- react-text: 241 -->);
            evt.preventDefault()
        }
    });

    <!-- /react-text --><span class="hljs-built_in" data-reactid="242">document</span><!-- react-text: 243 -->.getElementById(<!-- /react-text --><span class="hljs-string" data-reactid="244">&#x27;btn-1&#x27;</span><!-- react-text: 245 -->).addEventListener(<!-- /react-text --><span class="hljs-string" data-reactid="246">&#x27;click&#x27;</span><!-- react-text: 247 -->, <!-- /react-text --><span class="hljs-function" data-reactid="248"><span class="hljs-keyword" data-reactid="249">function</span><!-- react-text: 250 --> (<!-- /react-text --><span class="hljs-params" data-reactid="251">evt</span><!-- react-text: 252 -->) <!-- /react-text --></span><!-- react-text: 253 -->{
        <!-- /react-text --><span class="hljs-keyword" data-reactid="254">var</span><!-- react-text: 255 --> lines = dom.textContent.split(<!-- /react-text --><span class="hljs-string" data-reactid="256">&#x27;\n&#x27;</span><!-- react-text: 257 -->)
        <!-- /react-text --><span class="hljs-keyword" data-reactid="258">if</span><!-- react-text: 259 --> (lines.length &lt; <!-- /react-text --><span class="hljs-number" data-reactid="260">2</span><!-- react-text: 261 -->) <!-- /react-text --><span class="hljs-keyword" data-reactid="262">return</span><!-- react-text: 263 -->
        <!-- /react-text --><span class="hljs-keyword" data-reactid="264">var</span><!-- react-text: 265 --> start = <!-- /react-text --><span class="hljs-number" data-reactid="266">0</span><!-- react-text: 267 -->, end = <!-- /react-text --><span class="hljs-number" data-reactid="268">0</span><!-- react-text: 269 -->;
        start += lines[<!-- /react-text --><span class="hljs-number" data-reactid="270">0</span><!-- react-text: 271 -->].length + <!-- /react-text --><span class="hljs-number" data-reactid="272">1</span><!-- react-text: 273 -->
        end += start + lines[<!-- /react-text --><span class="hljs-number" data-reactid="274">1</span><!-- react-text: 275 -->].length
        <!-- /react-text --><span class="hljs-built_in" data-reactid="276">console</span><!-- react-text: 277 -->.log(start, end)
        selectionHelper(dom, {<!-- /react-text --><span class="hljs-attr" data-reactid="278">start</span><!-- react-text: 279 -->: start, <!-- /react-text --><span class="hljs-attr" data-reactid="280">end</span><!-- react-text: 281 -->: end})
    });
<!-- /react-text --></span><span class="hljs-tag" data-reactid="282"><!-- react-text: 283 -->&lt;/<!-- /react-text --><span class="hljs-name" data-reactid="284">script</span><!-- react-text: 285 -->&gt;<!-- /react-text --></span></code></pre><transformer-html-loader data-reactid="286"><div class="stage" data-reactid="287"><pre id="dom-editable" contenteditable="true" data-reactid="288">Input Here.
Second Line.
</pre><button id="btn-1" data-reactid="289">Select Second line</button></div><script type="text/javascript" data-reactid="290">function selectionHelper(e,t){var n={};if(void 0===t){var o=(l=window.getSelection().getRangeAt(0)).cloneRange();return o.selectNodeContents(e),o.setEnd(l.endContainer,l.endOffset),n.end=o.toString().length,o.setStart(l.startContainer,l.startOffset),n.start=n.end-o.toString().length,n.atStart=0===o.startOffset,n.commonAncestorContainer=o.commonAncestorContainer,n.endContainer=o.endContainer,n.startContainer=o.startContainer,n}for(var r,a,d=t.end&amp;&amp;t.end!==t.start,i=0,l=document.createRange(),s=t.start&gt;e.textContent.length?e.textContent.length:t.start,c=t.end&gt;e.textContent.length?e.textContent.length:t.end,g=t.atStart,m=0;m&lt;e.childNodes.length;m++)if((r=e.childNodes[m]).nodeType===Node.TEXT_NODE){var f=i;if(i+=r.textContent.length,!a&amp;&amp;(g?s&lt;i:s&lt;=i)&amp;&amp;(a=!0,l.setStart(r,s-f),!d)){l.collapse(!0),C(e,l);break}if(d&amp;&amp;c&lt;=i){l.setEnd(r,c-f),C(e,l);break}}function C(e,t){var n=window.getSelection();e.focus(),n.removeAllRanges(),n.addRange(t)}}var dom=document.getElementById(&quot;dom-editable&quot;);dom.addEventListener(&quot;keyup&quot;,function(e){console.log(selectionHelper(dom))}),dom.addEventListener(&quot;keydown&quot;,function(e){13===e.keyCode&amp;&amp;(document.execCommand(&quot;insertHTML&quot;,!1,&quot;\n&quot;),e.preventDefault())}),document.getElementById(&quot;btn-1&quot;).addEventListener(&quot;click&quot;,function(e){var t=dom.textContent.split(&quot;\n&quot;);if(!(t.length&lt;2)){var n=0,o=0;o+=(n+=t[0].length+1)+t[1].length,console.log(n,o),selectionHelper(dom,{start:n,end:o})}});</script></transformer-html-loader></article></div><div class="gitment-container" data-reactid="291"></div><div class="paginator" data-reactid="292"><a title="优雅的文档生成器 —— Picidae" class="prev" href="/graceful-document-maker-picidae" data-reactid="293">Prev</a><a title="Babel插件开发" class="next" href="/dev-babel-plugin" data-reactid="294">Next</a></div></div></main><footer data-reactid="295"><div class="copyright" data-reactid="296"><p data-reactid="297"><!-- react-text: 298 -->© 2017. Powered By <!-- /react-text --><a href="https://github.com/picidaejs/picidae" data-reactid="299">Picidae</a></p></div></footer></div>
</div>
<audio id="music" controls autoplay src="http://www.170mv.com/kw/other.web.ri01.sycdn.kuwo.cn/resource/n3/25/67/3891786006.mp3"></audio>
<script>
  !function () {
    var a = document.getElementById("music")
    a && (a.volume = 1)
  }()
</script>
<script src="/PICIDAE_COMMON.js"></script>
<script src="/PICIDAE_ENTRY.js"></script>
</body>
</html>
