<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/favicon.png" />
    <title> js实现打字机效果 - Grass </title>
    <link rel="stylesheet" href="/style.css">
    <style>
        #music {
            position: fixed;
            top: 10px;
            left: 10px;
        }
    </style>
</head>
<body>
<div id="root">
    <div class="wrap" data-reactroot="" data-reactid="1" data-react-checksum="1628044664"><header data-reactid="2"><a class="logo-link" href="/" data-reactid="3"><img src="/favicon.png" data-reactid="4"/></a><ul class="nav nav-list" data-reactid="5"><li class="nav-list-item" data-reactid="6"><a class="nav-list-link" href="/posts/1" data-reactid="7">Posts</a></li></ul></header><main data-reactid="8"><div class="post" data-reactid="9"><article class="post-block" data-reactid="10"><h1 class="post-title" data-reactid="11">js实现打字机效果</h1><div class="post-info" data-reactid="12"><time datetime="2016-04-25T21:29:46+00:00" data-reactid="13">Apr 25, 2016 9:29 PM</time></div></article><div class="post-content" data-reactid="14"><article data-reactid="15"><style data-reactid="16">.transformer-react-render{border:1px dashed #959da5;border-radius:5px;display:block}.transformer-react-render-container&gt;pre{max-height:400px;transition:all .2s ease}.transformer-react-render-container&gt;pre.focused{max-height:none;box-shadow:0 0 6px rgba(0,0,0,.2)}</style><script data-reactid="17">function typeHandle(e){e.type({delay:100,dest:e,twinkle:&quot;_&quot;})}HTMLElement.prototype.findParentByTag=function(e){for(var t=this.parentElement;t.tagName!=e;)t=t.parentElement;return t},HTMLElement.prototype.type=function(t){t=Object.extend({delay:25,dest:this,twinkle:&quot;|&quot;},t);var n=function(e){for(var t=e.childNodes,n=[],r=0;r&lt;t.length;r++){var a=t[r];if(1==a.nodeType){if(&quot;SCRIPT&quot;==a.tagName){n.push(a.outerHTML);continue}var i=a.cloneNode().outerHTML,o=i.lastIndexOf(&quot;&lt;&quot;);n.push(i.substring(0,o)),(n=n.concat(arguments.callee(a))).push(i.substring(o))}else if(3==a.nodeType){var l=a.textContent.match(/(\s+|[^\s])/g);l&amp;&amp;(n=n.concat(l))}}return n}(this),r=!1,a=&quot;&quot;;console.log(n);var i=t.dest;i.innerHTML=&quot;&quot;;var o=setInterval(function(){for(var e=n.shift();1&lt;e.length;)if(a+=e,i.innerHTML=a,e=n.shift(),!n.length)return void clearInterval(o);if(a+=e,!n.length)return i.innerHTML=a,void clearInterval(o);i.innerHTML=a+(r?t.twinkle:&quot; &quot;),r=!r},t.delay)},Object.extend=function(){if(!arguments||!arguments.length)return{};for(var e=arguments[0],t=0;t&lt;arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e};</script><p class="text-center" data-reactid="18"><button class="btn" data-reactid="19">Click Me! Magic</button></p><img src="/avatar-right.jpg" data-reactid="20"/><p class="text-center" data-reactid="21"><input placeholder="input!" data-reactid="22"/></p><h1 id="好像挺好玩的哈" data-reactid="23"><a href="#%E5%A5%BD%E5%83%8F%E6%8C%BA%E5%A5%BD%E7%8E%A9%E7%9A%84%E5%93%88" aria-hidden="true" data-reactid="24"><span class="icon icon-link" data-reactid="25"></span></a><!-- react-text: 26 -->好像挺好玩的哈<!-- /react-text --></h1><table data-reactid="27"><thead data-reactid="28"><tr data-reactid="29"><th data-reactid="30">项目</th><th data-reactid="31">价格</th><th data-reactid="32">数量</th></tr></thead><tbody data-reactid="33"><tr data-reactid="34"><td data-reactid="35">计算机</td><td data-reactid="36">\$1600</td><td data-reactid="37">5</td></tr><tr data-reactid="38"><td data-reactid="39">手机</td><td data-reactid="40">\$12</td><td data-reactid="41">12</td></tr><tr data-reactid="42"><td data-reactid="43">管线</td><td data-reactid="44">\$1</td><td data-reactid="45">234</td></tr></tbody></table><h1 id="借鉴了两份代码" data-reactid="46"><a href="#%E5%80%9F%E9%89%B4%E4%BA%86%E4%B8%A4%E4%BB%BD%E4%BB%A3%E7%A0%81" aria-hidden="true" data-reactid="47"><span class="icon icon-link" data-reactid="48"></span></a><!-- react-text: 49 -->借鉴了两份代码<!-- /react-text --></h1><ul data-reactid="50"><li data-reactid="51">jQuery版本</li></ul><pre data-reactid="52"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="53"><!-- react-text: 54 -->(<!-- /react-text --><span class="hljs-function" data-reactid="55"><span class="hljs-keyword" data-reactid="56">function</span><!-- react-text: 57 --> (<!-- /react-text --><span class="hljs-params" data-reactid="58">a</span><!-- react-text: 59 -->) <!-- /react-text --></span><!-- react-text: 60 -->{
    a.fn.typewriter = <!-- /react-text --><span class="hljs-function" data-reactid="61"><span class="hljs-keyword" data-reactid="62">function</span><!-- react-text: 63 --> (<!-- /react-text --><span class="hljs-params" data-reactid="64"></span><!-- react-text: 65 -->) <!-- /react-text --></span><!-- react-text: 66 -->{
        <!-- /react-text --><span class="hljs-keyword" data-reactid="67">this</span><!-- react-text: 68 -->.each(<!-- /react-text --><span class="hljs-function" data-reactid="69"><span class="hljs-keyword" data-reactid="70">function</span><!-- react-text: 71 --> (<!-- /react-text --><span class="hljs-params" data-reactid="72"></span><!-- react-text: 73 -->) <!-- /react-text --></span><!-- react-text: 74 -->{
            <!-- /react-text --><span class="hljs-keyword" data-reactid="75">var</span><!-- react-text: 76 --> d = a(<!-- /react-text --><span class="hljs-keyword" data-reactid="77">this</span><!-- react-text: 78 -->), c = d.html(), b = <!-- /react-text --><span class="hljs-number" data-reactid="79">0</span><!-- react-text: 80 -->;
            d.show();
            d.html(<!-- /react-text --><span class="hljs-string" data-reactid="81">&quot;&quot;</span><!-- react-text: 82 -->);
            <!-- /react-text --><span class="hljs-keyword" data-reactid="83">var</span><!-- react-text: 84 --> e = setInterval(<!-- /react-text --><span class="hljs-function" data-reactid="85"><span class="hljs-keyword" data-reactid="86">function</span><!-- react-text: 87 --> (<!-- /react-text --><span class="hljs-params" data-reactid="88"></span><!-- react-text: 89 -->) <!-- /react-text --></span><!-- react-text: 90 -->{
                <!-- /react-text --><span class="hljs-keyword" data-reactid="91">var</span><!-- react-text: 92 --> f = c.substr(b, <!-- /react-text --><span class="hljs-number" data-reactid="93">1</span><!-- react-text: 94 -->);
                <!-- /react-text --><span class="hljs-keyword" data-reactid="95">if</span><!-- react-text: 96 --> (f == <!-- /react-text --><span class="hljs-string" data-reactid="97">&quot;&lt;&quot;</span><!-- react-text: 98 -->) {
                    b = c.indexOf(<!-- /react-text --><span class="hljs-string" data-reactid="99">&quot;&gt;&quot;</span><!-- react-text: 100 -->, b) + <!-- /react-text --><span class="hljs-number" data-reactid="101">1</span><!-- react-text: 102 -->
                } <!-- /react-text --><span class="hljs-keyword" data-reactid="103">else</span><!-- react-text: 104 --> {
                    b++
                }
                d.html(c.substring(<!-- /react-text --><span class="hljs-number" data-reactid="105">0</span><!-- react-text: 106 -->, b) + (b &amp; <!-- /react-text --><span class="hljs-number" data-reactid="107">1</span><!-- react-text: 108 --> ? <!-- /react-text --><span class="hljs-string" data-reactid="109">&quot;_&quot;</span><!-- react-text: 110 --> : <!-- /react-text --><span class="hljs-string" data-reactid="111">&quot;&quot;</span><!-- react-text: 112 -->));
                <!-- /react-text --><span class="hljs-keyword" data-reactid="113">if</span><!-- react-text: 114 --> (b &gt;= c.length) {
                    clearInterval(e)
                }
            }, <!-- /react-text --><span class="hljs-number" data-reactid="115">75</span><!-- react-text: 116 -->)
        });
        <!-- /react-text --><span class="hljs-keyword" data-reactid="117">return</span><!-- react-text: 118 --> <!-- /react-text --><span class="hljs-keyword" data-reactid="119">this</span><!-- react-text: 120 -->
    }
})(jQuery);<!-- /react-text --></code></pre><ul data-reactid="121"><li data-reactid="122">原生JS版本</li></ul><pre data-reactid="123"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="124"><span class="hljs-function" data-reactid="125"><span class="hljs-keyword" data-reactid="126">function</span><!-- react-text: 127 --> <!-- /react-text --><span class="hljs-title" data-reactid="128">Typing</span><!-- react-text: 129 -->(<!-- /react-text --><span class="hljs-params" data-reactid="130">opts</span><!-- react-text: 131 -->) <!-- /react-text --></span><!-- react-text: 132 -->{
    <!-- /react-text --><span class="hljs-keyword" data-reactid="133">this</span><!-- react-text: 134 -->.version = <!-- /react-text --><span class="hljs-string" data-reactid="135">&#x27;1.1&#x27;</span><!-- react-text: 136 -->;
    <!-- /react-text --><span class="hljs-keyword" data-reactid="137">this</span><!-- react-text: 138 -->.source = opts.source;
    <!-- /react-text --><span class="hljs-keyword" data-reactid="139">this</span><!-- react-text: 140 -->.output = opts.output;
    <!-- /react-text --><span class="hljs-keyword" data-reactid="141">this</span><!-- react-text: 142 -->.delay = opts.delay || <!-- /react-text --><span class="hljs-number" data-reactid="143">120</span><!-- react-text: 144 -->;
    <!-- /react-text --><span class="hljs-keyword" data-reactid="145">this</span><!-- react-text: 146 -->.chain = {
        <!-- /react-text --><span class="hljs-attr" data-reactid="147">parent</span><!-- react-text: 148 -->: <!-- /react-text --><span class="hljs-literal" data-reactid="149">null</span><!-- react-text: 150 -->,
        <!-- /react-text --><span class="hljs-attr" data-reactid="151">dom</span><!-- react-text: 152 -->: <!-- /react-text --><span class="hljs-keyword" data-reactid="153">this</span><!-- react-text: 154 -->.output,
        <!-- /react-text --><span class="hljs-attr" data-reactid="155">val</span><!-- react-text: 156 -->: []
    }
}

Typing.fn = Typing.prototype = {
    <!-- /react-text --><span class="hljs-attr" data-reactid="157">toArray</span><!-- react-text: 158 -->: <!-- /react-text --><span class="hljs-function" data-reactid="159"><span class="hljs-keyword" data-reactid="160">function</span><!-- react-text: 161 -->(<!-- /react-text --><span class="hljs-params" data-reactid="162">eles</span><!-- react-text: 163 -->) <!-- /react-text --></span><!-- react-text: 164 -->{
        <!-- /react-text --><span class="hljs-comment" data-reactid="165">//Array.prototype.slice;</span><!-- react-text: 166 -->
        <!-- /react-text --><span class="hljs-keyword" data-reactid="167">var</span><!-- react-text: 168 --> result = [];
        <!-- /react-text --><span class="hljs-keyword" data-reactid="169">for</span><!-- react-text: 170 --> (<!-- /react-text --><span class="hljs-keyword" data-reactid="171">var</span><!-- react-text: 172 --> i = <!-- /react-text --><span class="hljs-number" data-reactid="173">0</span><!-- react-text: 174 -->; i &lt; eles.length; i++) {
            result.push(eles[i]);
        }
        <!-- /react-text --><span class="hljs-keyword" data-reactid="175">return</span><!-- react-text: 176 --> result;
    },
    <!-- /react-text --><span class="hljs-attr" data-reactid="177">init</span><!-- react-text: 178 -->: <!-- /react-text --><span class="hljs-function" data-reactid="179"><span class="hljs-keyword" data-reactid="180">function</span><!-- react-text: 181 -->(<!-- /react-text --><span class="hljs-params" data-reactid="182"></span><!-- react-text: 183 -->) <!-- /react-text --></span><!-- react-text: 184 -->{
        <!-- /react-text --><span class="hljs-keyword" data-reactid="185">this</span><!-- react-text: 186 -->.chain.val = <!-- /react-text --><span class="hljs-keyword" data-reactid="187">this</span><!-- react-text: 188 -->.convert(<!-- /react-text --><span class="hljs-keyword" data-reactid="189">this</span><!-- react-text: 190 -->.source, <!-- /react-text --><span class="hljs-keyword" data-reactid="191">this</span><!-- react-text: 192 -->.chain.val);
    },
    <!-- /react-text --><span class="hljs-attr" data-reactid="193">convert</span><!-- react-text: 194 -->: <!-- /react-text --><span class="hljs-function" data-reactid="195"><span class="hljs-keyword" data-reactid="196">function</span><!-- react-text: 197 -->(<!-- /react-text --><span class="hljs-params" data-reactid="198">dom, arr</span><!-- react-text: 199 -->) <!-- /react-text --></span><!-- react-text: 200 -->{
        <!-- /react-text --><span class="hljs-keyword" data-reactid="201">var</span><!-- react-text: 202 --> that = <!-- /react-text --><span class="hljs-keyword" data-reactid="203">this</span><!-- react-text: 204 -->,
            children = <!-- /react-text --><span class="hljs-keyword" data-reactid="205">this</span><!-- react-text: 206 -->.toArray(dom.childNodes);

        children.forEach(<!-- /react-text --><span class="hljs-function" data-reactid="207"><span class="hljs-keyword" data-reactid="208">function</span><!-- react-text: 209 -->(<!-- /react-text --><span class="hljs-params" data-reactid="210">node</span><!-- react-text: 211 -->) <!-- /react-text --></span><!-- react-text: 212 -->{
            <!-- /react-text --><span class="hljs-keyword" data-reactid="213">if</span><!-- react-text: 214 --> (node.nodeType === <!-- /react-text --><span class="hljs-number" data-reactid="215">3</span><!-- react-text: 216 -->) {
                arr = arr.concat(node.nodeValue.split(<!-- /react-text --><span class="hljs-string" data-reactid="217">&#x27;&#x27;</span><!-- react-text: 218 -->));
            } <!-- /react-text --><span class="hljs-keyword" data-reactid="219">else</span><!-- react-text: 220 --> <!-- /react-text --><span class="hljs-keyword" data-reactid="221">if</span><!-- react-text: 222 --> (node.nodeType === <!-- /react-text --><span class="hljs-number" data-reactid="223">1</span><!-- react-text: 224 -->) {
                <!-- /react-text --><span class="hljs-keyword" data-reactid="225">var</span><!-- react-text: 226 --> val = [];
                val = that.convert(node, val);
                arr.push({
                    <!-- /react-text --><span class="hljs-string" data-reactid="227">&#x27;dom&#x27;</span><!-- react-text: 228 -->: node,
                    <!-- /react-text --><span class="hljs-string" data-reactid="229">&#x27;val&#x27;</span><!-- react-text: 230 -->: val
                });
            }
        });

        <!-- /react-text --><span class="hljs-keyword" data-reactid="231">return</span><!-- react-text: 232 --> arr;
    },
    <!-- /react-text --><span class="hljs-attr" data-reactid="233">print</span><!-- react-text: 234 -->: <!-- /react-text --><span class="hljs-function" data-reactid="235"><span class="hljs-keyword" data-reactid="236">function</span><!-- react-text: 237 -->(<!-- /react-text --><span class="hljs-params" data-reactid="238">dom, val, callback</span><!-- react-text: 239 -->) <!-- /react-text --></span><!-- react-text: 240 -->{
        setTimeout(<!-- /react-text --><span class="hljs-function" data-reactid="241"><span class="hljs-keyword" data-reactid="242">function</span><!-- react-text: 243 -->(<!-- /react-text --><span class="hljs-params" data-reactid="244"></span><!-- react-text: 245 -->) <!-- /react-text --></span><!-- react-text: 246 -->{
            dom.appendChild(<!-- /react-text --><span class="hljs-built_in" data-reactid="247">document</span><!-- react-text: 248 -->.createTextNode(val));
            callback();
        }, <!-- /react-text --><span class="hljs-keyword" data-reactid="249">this</span><!-- react-text: 250 -->.delay);
    },
    <!-- /react-text --><span class="hljs-attr" data-reactid="251">play</span><!-- react-text: 252 -->: <!-- /react-text --><span class="hljs-function" data-reactid="253"><span class="hljs-keyword" data-reactid="254">function</span><!-- react-text: 255 -->(<!-- /react-text --><span class="hljs-params" data-reactid="256">ele</span><!-- react-text: 257 -->) <!-- /react-text --></span><!-- react-text: 258 -->{
        <!-- /react-text --><span class="hljs-keyword" data-reactid="259">if</span><!-- react-text: 260 --> (!ele) <!-- /react-text --><span class="hljs-keyword" data-reactid="261">return</span><!-- react-text: 262 -->;
        <!-- /react-text --><span class="hljs-keyword" data-reactid="263">if</span><!-- react-text: 264 --> (!ele.val.length &amp;&amp; ele.parent) <!-- /react-text --><span class="hljs-keyword" data-reactid="265">this</span><!-- react-text: 266 -->.play(ele.parent);
        <!-- /react-text --><span class="hljs-keyword" data-reactid="267">if</span><!-- react-text: 268 --> (!ele.val.length) <!-- /react-text --><span class="hljs-keyword" data-reactid="269">return</span><!-- react-text: 270 -->;

        <!-- /react-text --><span class="hljs-keyword" data-reactid="271">var</span><!-- react-text: 272 --> curr = ele.val.shift();
        <!-- /react-text --><span class="hljs-keyword" data-reactid="273">var</span><!-- react-text: 274 --> that = <!-- /react-text --><span class="hljs-keyword" data-reactid="275">this</span><!-- react-text: 276 -->;

        <!-- /react-text --><span class="hljs-keyword" data-reactid="277">if</span><!-- react-text: 278 --> (<!-- /react-text --><span class="hljs-keyword" data-reactid="279">typeof</span><!-- react-text: 280 --> curr === <!-- /react-text --><span class="hljs-string" data-reactid="281">&#x27;string&#x27;</span><!-- react-text: 282 -->) {
            <!-- /react-text --><span class="hljs-keyword" data-reactid="283">this</span><!-- react-text: 284 -->.print(ele.dom, curr, <!-- /react-text --><span class="hljs-function" data-reactid="285"><span class="hljs-keyword" data-reactid="286">function</span><!-- react-text: 287 -->(<!-- /react-text --><span class="hljs-params" data-reactid="288"></span><!-- react-text: 289 -->) <!-- /react-text --></span><!-- react-text: 290 -->{
                <!-- /react-text --><span class="hljs-keyword" data-reactid="291">if</span><!-- react-text: 292 --> (ele.val.length) {
                    that.play(ele);
                } <!-- /react-text --><span class="hljs-keyword" data-reactid="293">else</span><!-- react-text: 294 --> <!-- /react-text --><span class="hljs-keyword" data-reactid="295">if</span><!-- react-text: 296 --> (ele.parent) {
                    that.play(ele.parent);
                }
            });
        } <!-- /react-text --><span class="hljs-keyword" data-reactid="297">else</span><!-- react-text: 298 --> {
            <!-- /react-text --><span class="hljs-keyword" data-reactid="299">var</span><!-- react-text: 300 --> dom = <!-- /react-text --><span class="hljs-built_in" data-reactid="301">document</span><!-- react-text: 302 -->.createElement(curr.dom.nodeName);
            <!-- /react-text --><span class="hljs-keyword" data-reactid="303">var</span><!-- react-text: 304 --> attrs = that.toArray(curr.dom.attributes);
            attrs.forEach(<!-- /react-text --><span class="hljs-function" data-reactid="305"><span class="hljs-keyword" data-reactid="306">function</span><!-- react-text: 307 -->(<!-- /react-text --><span class="hljs-params" data-reactid="308">attr</span><!-- react-text: 309 -->) <!-- /react-text --></span><!-- react-text: 310 -->{
                dom.setAttribute(attr.name, attr.value);
            });
            ele.dom.appendChild(dom);
            curr.parent = ele;
            curr.dom = dom;
            <!-- /react-text --><span class="hljs-keyword" data-reactid="311">this</span><!-- react-text: 312 -->.play(curr.val.length ? curr : curr.parent);
        }
    },
    <!-- /react-text --><span class="hljs-attr" data-reactid="313">start</span><!-- react-text: 314 -->: <!-- /react-text --><span class="hljs-function" data-reactid="315"><span class="hljs-keyword" data-reactid="316">function</span><!-- react-text: 317 -->(<!-- /react-text --><span class="hljs-params" data-reactid="318"></span><!-- react-text: 319 -->) <!-- /react-text --></span><!-- react-text: 320 -->{
        <!-- /react-text --><span class="hljs-keyword" data-reactid="321">this</span><!-- react-text: 322 -->.init();
        <!-- /react-text --><span class="hljs-keyword" data-reactid="323">this</span><!-- react-text: 324 -->.play(<!-- /react-text --><span class="hljs-keyword" data-reactid="325">this</span><!-- react-text: 326 -->.chain);
    }
}<!-- /react-text --></code></pre><h1 id="之我见" data-reactid="327"><a href="#%E4%B9%8B%E6%88%91%E8%A7%81" aria-hidden="true" data-reactid="328"><span class="icon icon-link" data-reactid="329"></span></a><!-- react-text: 330 -->之我见<!-- /react-text --></h1><ul data-reactid="331"><li data-reactid="332"><!-- react-text: 333 -->第一份jQuery版本，只是对<!-- /react-text --><code data-reactid="334">&#x27;&lt;&#x27;</code><!-- react-text: 335 -->,<!-- /react-text --><code data-reactid="336">&#x27;&gt;&#x27;</code><!-- react-text: 337 -->两个特殊的字符串进行了判断处理，如果打印那种代码文本时将会有误。<!-- /react-text --></li><li data-reactid="338">第二份原生JS代码，将元素的孩子结点都进行了处理，这是一种很好的方法，但是，他的数据结构有些复杂化了，有</li></ul><pre data-reactid="339"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="340"><!-- react-text: 341 -->{
	<!-- /react-text --><span class="hljs-attr" data-reactid="342">parent</span><!-- react-text: 343 -->: <!-- /react-text --><span class="hljs-literal" data-reactid="344">null</span><!-- react-text: 345 -->,
	<!-- /react-text --><span class="hljs-attr" data-reactid="346">dom</span><!-- react-text: 347 -->: <!-- /react-text --><span class="hljs-keyword" data-reactid="348">this</span><!-- react-text: 349 -->.output,
	<!-- /react-text --><span class="hljs-attr" data-reactid="350">val</span><!-- react-text: 351 -->: []
}<!-- /react-text --></code></pre><p data-reactid="352">对于那种标签嵌套比较严重和多余的文本结点较多的html处理起来不太美好。</p><h1 id="之我改" data-reactid="353"><a href="#%E4%B9%8B%E6%88%91%E6%94%B9" aria-hidden="true" data-reactid="354"><span class="icon icon-link" data-reactid="355"></span></a><!-- react-text: 356 -->之我改<!-- /react-text --></h1><pre data-reactid="357"><code class="hljs language-javascript" data-query="{}" data-lang="javascript" data-reactid="358"><!-- react-text: 359 -->HTMLElement.prototype.type = <!-- /react-text --><span class="hljs-function" data-reactid="360"><span class="hljs-keyword" data-reactid="361">function</span><!-- react-text: 362 -->(<!-- /react-text --><span class="hljs-params" data-reactid="363">op</span><!-- react-text: 364 -->)<!-- /react-text --></span><!-- react-text: 365 -->{
	op = <!-- /react-text --><span class="hljs-built_in" data-reactid="366">Object</span><!-- react-text: 367 -->.extend({
		<!-- /react-text --><span class="hljs-attr" data-reactid="368">delay</span><!-- react-text: 369 -->:<!-- /react-text --><span class="hljs-number" data-reactid="370">25</span><!-- react-text: 371 -->,
		<!-- /react-text --><span class="hljs-attr" data-reactid="372">dest</span><!-- react-text: 373 -->:<!-- /react-text --><span class="hljs-keyword" data-reactid="374">this</span><!-- react-text: 375 -->,
		<!-- /react-text --><span class="hljs-attr" data-reactid="376">twinkle</span><!-- react-text: 377 -->:<!-- /react-text --><span class="hljs-string" data-reactid="378">&#x27;|&#x27;</span><!-- react-text: 379 -->
	},op);
	<!-- /react-text --><span class="hljs-keyword" data-reactid="380">var</span><!-- react-text: 381 --> chain = makeChain(<!-- /react-text --><span class="hljs-keyword" data-reactid="382">this</span><!-- react-text: 383 -->),f=<!-- /react-text --><span class="hljs-literal" data-reactid="384">false</span><!-- react-text: 385 -->,html=<!-- /react-text --><span class="hljs-string" data-reactid="386">&#x27;&#x27;</span><!-- react-text: 387 -->;
	<!-- /react-text --><span class="hljs-built_in" data-reactid="388">console</span><!-- react-text: 389 -->.log(chain);
	<!-- /react-text --><span class="hljs-keyword" data-reactid="390">var</span><!-- react-text: 391 --> dest = op.dest;
	dest.innerHTML=<!-- /react-text --><span class="hljs-string" data-reactid="392">&#x27;&#x27;</span><!-- react-text: 393 -->;
	<!-- /react-text --><span class="hljs-keyword" data-reactid="394">var</span><!-- react-text: 395 --> time = setInterval(<!-- /react-text --><span class="hljs-function" data-reactid="396"><span class="hljs-keyword" data-reactid="397">function</span><!-- react-text: 398 -->(<!-- /react-text --><span class="hljs-params" data-reactid="399"></span><!-- react-text: 400 -->)<!-- /react-text --></span><!-- react-text: 401 -->{
		<!-- /react-text --><span class="hljs-keyword" data-reactid="402">var</span><!-- react-text: 403 --> str = chain.shift();
		<!-- /react-text --><span class="hljs-keyword" data-reactid="404">while</span><!-- react-text: 405 -->(str.length&gt;<!-- /react-text --><span class="hljs-number" data-reactid="406">1</span><!-- react-text: 407 -->){
			html+=str;
			dest.innerHTML=html;
			str = chain.shift();
			<!-- /react-text --><span class="hljs-keyword" data-reactid="408">if</span><!-- react-text: 409 -->(!chain.length){ 
				clearInterval(time);
				<!-- /react-text --><span class="hljs-keyword" data-reactid="410">return</span><!-- react-text: 411 -->;
			}
		}
		html+=str;
		<!-- /react-text --><span class="hljs-keyword" data-reactid="412">if</span><!-- react-text: 413 -->(!chain.length){ 
			dest.innerHTML=html
			clearInterval(time);
			<!-- /react-text --><span class="hljs-keyword" data-reactid="414">return</span><!-- react-text: 415 -->;
		}
		dest.innerHTML=html+(f?op.twinkle:<!-- /react-text --><span class="hljs-string" data-reactid="416">&#x27; &#x27;</span><!-- react-text: 417 -->);
		f=!f;
	},op.delay);
	<!-- /react-text --><span class="hljs-function" data-reactid="418"><span class="hljs-keyword" data-reactid="419">function</span><!-- react-text: 420 --> <!-- /react-text --><span class="hljs-title" data-reactid="421">makeChain</span><!-- react-text: 422 -->(<!-- /react-text --><span class="hljs-params" data-reactid="423">node</span><!-- react-text: 424 -->)<!-- /react-text --></span><!-- react-text: 425 -->{
		<!-- /react-text --><span class="hljs-keyword" data-reactid="426">var</span><!-- react-text: 427 --> nodes = node.childNodes;
		<!-- /react-text --><span class="hljs-keyword" data-reactid="428">var</span><!-- react-text: 429 --> chain = [];
		<!-- /react-text --><span class="hljs-keyword" data-reactid="430">for</span><!-- react-text: 431 -->(<!-- /react-text --><span class="hljs-keyword" data-reactid="432">var</span><!-- react-text: 433 --> i=<!-- /react-text --><span class="hljs-number" data-reactid="434">0</span><!-- react-text: 435 -->;i &lt; nodes.length;i++){
			<!-- /react-text --><span class="hljs-keyword" data-reactid="436">var</span><!-- react-text: 437 --> ne = nodes[i];
			<!-- /react-text --><span class="hljs-keyword" data-reactid="438">if</span><!-- react-text: 439 -->(ne.nodeType==<!-- /react-text --><span class="hljs-number" data-reactid="440">1</span><!-- react-text: 441 -->){
				<!-- /react-text --><span class="hljs-keyword" data-reactid="442">if</span><!-- react-text: 443 -->(ne.tagName==<!-- /react-text --><span class="hljs-string" data-reactid="444">&#x27;SCRIPT&#x27;</span><!-- react-text: 445 -->){
					chain.push(ne.outerHTML);
					<!-- /react-text --><span class="hljs-keyword" data-reactid="446">continue</span><!-- react-text: 447 -->;
				}
				<!-- /react-text --><span class="hljs-keyword" data-reactid="448">var</span><!-- react-text: 449 --> str = ne.cloneNode().outerHTML;
				<!-- /react-text --><span class="hljs-keyword" data-reactid="450">var</span><!-- react-text: 451 --> last = str.lastIndexOf(<!-- /react-text --><span class="hljs-string" data-reactid="452">&#x27;&lt;&#x27;</span><!-- react-text: 453 -->);
				chain.push(str.substring(<!-- /react-text --><span class="hljs-number" data-reactid="454">0</span><!-- react-text: 455 -->,last));
				chain = chain.concat(<!-- /react-text --><span class="hljs-built_in" data-reactid="456">arguments</span><!-- react-text: 457 -->.callee(ne));
				chain.push(str.substring(last));
			}<!-- /react-text --><span class="hljs-keyword" data-reactid="458">else</span><!-- react-text: 459 --> <!-- /react-text --><span class="hljs-keyword" data-reactid="460">if</span><!-- react-text: 461 -->(ne.nodeType==<!-- /react-text --><span class="hljs-number" data-reactid="462">3</span><!-- react-text: 463 -->){
				<!-- /react-text --><span class="hljs-keyword" data-reactid="464">var</span><!-- react-text: 465 --> arr = ne.textContent.match(<!-- /react-text --><span class="hljs-regexp" data-reactid="466">/(\s+|[^\s])/g</span><!-- react-text: 467 -->);
				<!-- /react-text --><span class="hljs-keyword" data-reactid="468">if</span><!-- react-text: 469 -->(arr)	chain = chain.concat(arr);
			}
		}
		<!-- /react-text --><span class="hljs-keyword" data-reactid="470">return</span><!-- react-text: 471 --> chain;
	}
}
<!-- /react-text --><span class="hljs-built_in" data-reactid="472">Object</span><!-- react-text: 473 -->.extend = <!-- /react-text --><span class="hljs-function" data-reactid="474"><span class="hljs-keyword" data-reactid="475">function</span><!-- react-text: 476 -->(<!-- /react-text --><span class="hljs-params" data-reactid="477"></span><!-- react-text: 478 -->)<!-- /react-text --></span><!-- react-text: 479 -->{
	<!-- /react-text --><span class="hljs-keyword" data-reactid="480">if</span><!-- react-text: 481 -->(!<!-- /react-text --><span class="hljs-built_in" data-reactid="482">arguments</span><!-- react-text: 483 --> || !<!-- /react-text --><span class="hljs-built_in" data-reactid="484">arguments</span><!-- react-text: 485 -->.length) <!-- /react-text --><span class="hljs-keyword" data-reactid="486">return</span><!-- react-text: 487 --> {};
	<!-- /react-text --><span class="hljs-keyword" data-reactid="488">var</span><!-- react-text: 489 --> rlt = <!-- /react-text --><span class="hljs-built_in" data-reactid="490">arguments</span><!-- react-text: 491 -->[<!-- /react-text --><span class="hljs-number" data-reactid="492">0</span><!-- react-text: 493 -->];
	<!-- /react-text --><span class="hljs-keyword" data-reactid="494">for</span><!-- react-text: 495 -->(<!-- /react-text --><span class="hljs-keyword" data-reactid="496">var</span><!-- react-text: 497 --> i=<!-- /react-text --><span class="hljs-number" data-reactid="498">0</span><!-- react-text: 499 -->;i&lt;<!-- /react-text --><span class="hljs-built_in" data-reactid="500">arguments</span><!-- react-text: 501 -->.length;i++){
		<!-- /react-text --><span class="hljs-keyword" data-reactid="502">var</span><!-- react-text: 503 --> argu = <!-- /react-text --><span class="hljs-built_in" data-reactid="504">arguments</span><!-- react-text: 505 -->[i];
		<!-- /react-text --><span class="hljs-keyword" data-reactid="506">for</span><!-- react-text: 507 -->(<!-- /react-text --><span class="hljs-keyword" data-reactid="508">var</span><!-- react-text: 509 --> k <!-- /react-text --><span class="hljs-keyword" data-reactid="510">in</span><!-- react-text: 511 --> argu)
			rlt[k] = argu[k];
	}
	<!-- /react-text --><span class="hljs-keyword" data-reactid="512">return</span><!-- react-text: 513 --> rlt;
}<!-- /react-text --></code></pre><p data-reactid="514"><!-- react-text: 515 -->我吸取了前面两者的优点，比如第一份代码的简单直接，第二份代码的子节点遍历与递归的思路， 进一步的解决了前面两者的缺陷。 1. 对无实际意义的文本结点（如 <!-- /react-text --><code data-reactid="516">&quot; 12 \n sx &quot;</code><!-- react-text: 517 --> ）进行优化处理，处理为[&#x27; &#x27;,&#x27;1&#x27;,&#x27;2&#x27;,&#x27; \n &#x27;,&#x27;s&#x27;,&#x27;x&#x27;,&#x27; &#x27;] var arr = ne.textContent.match(/(\s+|[^\s.])/g); if(arr) chain = chain.concat(arr); 2. 对 <!-- /react-text --><code data-reactid="518">script</code><!-- react-text: 519 --> 标签进行优化处理，统一打印文字的节奏 if(ne.tagName==&#x27;SCRIPT&#x27;){ chain.push(ne.outerHTML); continue; } 3. 避免了打印代码块的错误 因为代码中分别对 <!-- /react-text --><code data-reactid="520">nodeType == 1</code><!-- react-text: 521 --> 和 <!-- /react-text --><code data-reactid="522">nodeType == 3</code><!-- react-text: 523 --> 进行了不同的处理， 可以根据 <!-- /react-text --><code data-reactid="524">chain</code><!-- react-text: 525 --> 中元素的长度判断是否为文本节点<!-- /react-text --></p><h1 id="之我版" data-reactid="526"><a href="#%E4%B9%8B%E6%88%91%E7%89%88" aria-hidden="true" data-reactid="527"><span class="icon icon-link" data-reactid="528"></span></a><!-- react-text: 529 -->之我版<!-- /react-text --></h1><p class="text-center" data-reactid="530">[fork it！](https://github.com/moyuyc/typemagic)</p></article></div><div class="gitment-container" data-reactid="531"></div><div class="paginator" data-reactid="532"><a title="canvas绘制平面花瓣" class="prev" href="/draw-flower-by-canvas" data-reactid="533">Prev</a><a title="js实现的图片瀑布流" class="next" href="/imgs-fallwater-by-js" data-reactid="534">Next</a></div></div></main><footer data-reactid="535"><div class="copyright" data-reactid="536"><p data-reactid="537"><!-- react-text: 538 -->© 2017. Powered By <!-- /react-text --><a href="https://github.com/picidaejs/picidae" data-reactid="539">Picidae</a></p></div></footer></div>
</div>
<audio id="music" controls autoplay src="http://www.170mv.com/kw/other.web.ri01.sycdn.kuwo.cn/resource/n3/25/67/3891786006.mp3"></audio>
<script>
  !function () {
    var a = document.getElementById("music")
    a && (a.volume = 1)
  }()
</script>
<script src="/PICIDAE_COMMON.js"></script>
<script src="/PICIDAE_ENTRY.js"></script>
</body>
</html>
