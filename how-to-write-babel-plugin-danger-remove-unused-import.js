webpackJsonp([58,90],{1005:function(s,a){s.exports={content:'<p>åœ¨ç°ä»£Webå‰ç«¯å¼€å‘ä¸­ï¼Œç¦»ä¸å¼€JavaScript es6/7ï¼Œè€Œ ES6/7 ä¸­æœ€å¸¸ç”¨çš„è¯­æ³•ç¿»è¯‘å½“å± Babel äº†ã€‚</p>\n<p>è¿™ç¯‡æ–‡ç« å°†å¸¦è¯»è€…ä»é›¶å¼€å§‹å¼€å‘ä¸€ä¸ªè‡ªå®šä¹‰çš„Babelæ’ä»¶ã€‚</p>\n<h2 id="babelæ˜¯ä»€ä¹ˆ"><a href="#babel%E6%98%AF%E4%BB%80%E4%B9%88" aria-hidden="true"><span class="icon icon-link"></span></a>Babelæ˜¯ä»€ä¹ˆ</h2>\n<p>Babel ä½¿ç”¨ babylon è§£æ JavaScript ä»£ç ï¼Œå¾—åˆ°æŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntax Treeï¼Œåæ–‡ç®€ç§° ASTï¼‰ã€‚<br>\nåŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨<code>babel-generator</code>ï¼Œè¾“å…¥ä¸€ä¸ªåˆæ³•çš„ ASTï¼Œè¿˜åŸæˆ JavaScript ä»£ç </p>\n<img src="http://obu9je6ng.bkt.clouddn.com/FkKXk5xwPpo_reQHW3U3Y_yGF991?imageslim" width="434" height="98"/>\n<p>ä»£ç å¦‚ä¸‹ï¼š </p>\n<pre><code class="hljs language-javascript" data-query="{}" data-lang="javascript">cosnt babel = <span class="hljs-built_in">require</span>(<span class="hljs-string">\'babel-core\'</span>)\n<span class="hljs-keyword">const</span> code = <span class="hljs-string">`\nimport e from \'./where\'\nconst [ a, b, c ] = [ 1, 2, 3 ]\n`</span>\n<span class="hljs-keyword">const</span> { ast } = babel.transform(code, { <span class="hljs-attr">ast</span>: <span class="hljs-literal">true</span> })\n\n<span class="hljs-keyword">const</span> generate = <span class="hljs-built_in">require</span>(<span class="hljs-string">\'babel-generator\'</span>)\n<span class="hljs-keyword">const</span> { <span class="hljs-attr">code</span>: codeFromBabel } = generate(ast)</code></pre>\n<h3 id="ast"><a href="#ast" aria-hidden="true"><span class="icon icon-link"></span></a>AST</h3>\n<p>ast åœ¨è¿™æ˜¯æŒ‡å°† JavaScript ä»£ç è¿›è¡Œè§£æå¾—åˆ°çš„æŠ½è±¡è¯­æ³•æ ‘ï¼ˆæ•°æ®ç»“æ„ï¼‰ã€‚<br>\nå¦‚ä»£ç </p>\n<pre><code class="hljs language-javascript" data-query="{}" data-lang="javascript"><span class="hljs-keyword">const</span> key = <span class="hljs-string">\'value\'</span></code></pre>\n<p>è§£æäº§ç”Ÿçš„ AST å¦‚ä¸‹å›¾æ‰€ç¤º\n<img src="http://obu9je6ng.bkt.clouddn.com/Foe8OrdCEPOhQX4-VHbqkOtDruF9?imageslim" width="426" height="488"/></p>\n<p>å»ºè®®ä½¿ç”¨ <a href="http://astexplorer.net/#/Z1exs6BWMq">AST Explorer</a> åœ¨çº¿é¢„è§ˆ AST</p>\n<h2 id="plugin-å’Œ-preset"><a href="#plugin-%E5%92%8C-preset" aria-hidden="true"><span class="icon icon-link"></span></a>Plugin å’Œ Preset</h2>\n<p>æˆ‘ä»¬åœ¨ä½¿ç”¨ Babel çš„æ—¶å€™ï¼Œé€šå¸¸éœ€è¦é…ç½®ä¸€äº›é¢„è®¾ï¼ˆpresetsï¼‰å’Œæ’ä»¶ï¼ˆpluginsï¼‰ã€‚\nå¦‚  </p>\n<pre><code class="hljs language-json" data-query="{}" data-lang="json">{\n  <span class="hljs-attr">"presets"</span>: [<span class="hljs-string">"env"</span>],\n  <span class="hljs-attr">"plugins"</span>: [<span class="hljs-string">"async-to-generator"</span>]\n}</code></pre>\n<p>å…¶å®ï¼Œpresetæ˜¯ä¸€å †pluginçš„ç»“åˆï¼Œé‚£ä¹ˆpluginåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<br>\nå¦‚ä¸‹å›¾ï¼Œplugin ä¼šè½¬æ¢ ASTï¼Œå¯¹ AST è¿›è¡Œå¤„ç†ï¼Œä»è€Œä¹Ÿèƒ½å¤Ÿå½±å“åˆ°äº§ç”Ÿå‡ºæ¥çš„ JS Codeã€‚</p>\n<img src="http://obu9je6ng.bkt.clouddn.com/FmBuevqTrAt8VApb-bnWygS6cwrK?imageslim" width="489" height="114"/>\n<p>åœ¨åæ–‡ä¸­å­¦ä¹ äº†å¼€å‘ Babel æ’ä»¶åï¼Œå°†é˜è¿°ä¸€ä¸‹ Babel plugin å’Œ preset çš„æ‰§è¡Œè¿‡ç¨‹å’Œé¡ºåºã€‚</p>\n<h2 id="å¼€å‘-babel-æ’ä»¶"><a href="#%E5%BC%80%E5%8F%91-babel-%E6%8F%92%E4%BB%B6" aria-hidden="true"><span class="icon icon-link"></span></a>å¼€å‘ Babel æ’ä»¶</h2>\n<p>äº†è§£äº† Babel æ’ä»¶çš„æ¦‚å¿µåï¼Œè®©æˆ‘ä»¬åŠ¨æ‰‹æ’¸ä¸€ä¸ª Babel æ’ä»¶å§ï¼  </p>\n<h3 id="æƒ…æ™¯å†ç°"><a href="#%E6%83%85%E6%99%AF%E5%86%8D%E7%8E%B0" aria-hidden="true"><span class="icon icon-link"></span></a>æƒ…æ™¯å†ç°</h3>\n<p>åœ¨ä½¿ç”¨æ„å»ºå·¥å…· Webpack å¼€å‘å¤§å‹é¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½é€šå¸¸éœ€è¦ import ä¸€å¤§ä¸²ä¾èµ–</p>\n<pre><code class="hljs language-javascript" data-query="{}" data-lang="javascript"><span class="hljs-keyword">import</span> a <span class="hljs-keyword">from</span> <span class="hljs-string">\'a\'</span>\n<span class="hljs-keyword">import</span> b <span class="hljs-keyword">from</span> <span class="hljs-string">\'b\'</span>\n<span class="hljs-keyword">import</span> c <span class="hljs-keyword">from</span> <span class="hljs-string">\'c\'</span>\n<span class="hljs-comment">// ...</span>\n\n<span class="hljs-comment">// code here</span></code></pre>\n<p>ä½†æ˜¯åœ¨å¼€å‘çš„é€»è¾‘ä¸­å¯èƒ½åªéœ€è¦ç”¨åˆ°å…¶ä¸­çš„ä¸€ä¸¢ä¸¢ä¾èµ–ï¼Œæ¯”å¦‚ <code>a</code>ï¼Œé‚£ä¹ˆä¾èµ–<code>b</code> <code>c</code> éƒ½æ˜¯â€œæ— æ•ˆâ€çš„ä¾èµ–ã€‚</p>\n<p><strong>æ³¨æ„ï¼š</strong> æ— æ•ˆåªæ˜¯ç›¸å¯¹è€Œè¨€çš„ï¼Œå› ä¸ºåœ¨ <code>\'b\', \'c\'</code> ä¾èµ–ä¸­å¯èƒ½ä¼šæ‰§è¡Œä¸€äº›å‰¯ä½œç”¨çš„é€»è¾‘ã€‚å¦‚è®¾ç½®å…¨å±€å˜é‡ï¼Œç¯å¢ƒå˜é‡ï¼Œåšäº›åˆå§‹åŒ–å·¥ä½œ...</p>\n<p>åœ¨ä¼˜åŒ–é¡¹ç›®çš„æ—¶å€™ï¼Œå°±éœ€è¦è€ƒè™‘åˆ°å»é™¤æ‰æ— æ•ˆçš„ <code>import</code> è¯­å¥äº†ï¼Œè¿™æ ·å¯ä»¥ä¸€å®šç¨‹åº¦ä¸ŠåŠ å¿«ç¨‹åºæ‰§è¡Œé€Ÿåº¦ï¼Œç¼©å°æ‰“åŒ…å‡ºæ¥çš„ bundle å¤§å°ã€‚</p>\n<h3 id="å¼€å‘æ’ä»¶ï¼"><a href="#%E5%BC%80%E5%8F%91%E6%8F%92%E4%BB%B6%EF%BC%81" aria-hidden="true"><span class="icon icon-link"></span></a>å¼€å‘æ’ä»¶ï¼</h3>\n<p>ä¸æƒ³å·æ‡’çš„å¢¨é±¼ä¸æ˜¯å¥½ç¨‹åºå‘˜ï¼å¯¹äºä¸Šé¢çš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡å¼€å‘ Babel æ’ä»¶æ¥å®ç°ï¼Œå‡å°‘æˆ‘ä»¬çš„äººåŠ›å·¥ä½œé‡ã€‚</p>\n<p><strong>ç¨‹åºæ€è·¯</strong>\n1. æ ¹æ® <code>import ...</code> è¯­æ³•ï¼Œå¾—åˆ° imported å˜é‡åé›†åˆ<br>\n2. è¿‡æ»¤æ‰ä½¿ç”¨è¿‡çš„ imported å˜é‡å<br>\n3. ç§»é™¤æ²¡æœ‰ä½¿ç”¨åˆ°çš„ <code>import ...</code> è¯­å¥</p>\n<p>æ€è·¯æ€»æ˜¯å¾ˆç®€å•ï¼Œä½†åªæœ‰çœŸæ­£å®ç°è¿‡çš„äººæ‰çŸ¥é“é‡Œé¢çš„å…·ä½“ç§ç§ã€‚</p>\n<p>Babel æ’ä»¶è¿”å›ä¸€ä¸ª function ï¼Œå…¥å‚ä¸º babel å¯¹è±¡ï¼Œè¿”å› Objectã€‚</p>\n<p>å…¶ä¸­ <code>pre</code>, <code>post</code> åˆ†åˆ«åœ¨è¿›å…¥/ç¦»å¼€ AST çš„æ—¶å€™è§¦å‘ï¼Œæ‰€ä»¥ä¸€èˆ¬åˆ†åˆ«ç”¨æ¥åšåˆå§‹åŒ–/åˆ é™¤å¯¹è±¡çš„æ“ä½œ</p>\n<pre><code class="hljs language-javascript" data-query="{}" data-lang="javascript"><span class="hljs-built_in">module</span>.exports = <span class="hljs-function">(<span class="hljs-params">babel</span>) =></span> {\n  <span class="hljs-keyword">return</span> {\n    pre(path) {\n      <span class="hljs-keyword">this</span>.runtimeData = {}\n    },\n    <span class="hljs-attr">visitor</span>: {},\n    post(path) {\n      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.runtimeData\n    }\n  }\n}</code></pre>\n<p>ç„¶åæ˜¯ visitor è®¿é—®è€…å¯¹è±¡ã€‚</p>\n<p>å…ˆçœ‹ä¸ªç®€å•çš„ä¾‹å­ï¼š<br>\nå¦‚éœ€è¦å°†å¦‚ä¸‹ä»£ç ä¸­çš„ x å˜é‡é‡å‘½åä¸º y</p>\n<pre><code class="hljs language-javascript" data-query="{}" data-lang="javascript"><span class="hljs-keyword">const</span> x = <span class="hljs-string">\'x\'</span>\nalert(x)</code></pre>\n<p>visitor ä¹¦å†™ä¸ºï¼š</p>\n<pre><code class="hljs language-javascript" data-query="{}" data-lang="javascript"><span class="hljs-keyword">const</span> visitor = {\n    Identifier(path, data) {\n        <span class="hljs-keyword">if</span> (path.node.name === <span class="hljs-string">\'x\'</span>) {\n            path.node.name = <span class="hljs-string">\'y\'</span>\n        }\n    }\n}</code></pre>\n<p>è¾“å‡ºä¸ºï¼š</p>\n<pre><code class="hljs language-javascript" data-query="{}" data-lang="javascript"><span class="hljs-keyword">const</span> y = <span class="hljs-string">\'x\'</span>\nalert(y)</code></pre>\n<p>å¯ä»¥çœ‹å‡ºï¼Œvisitor æ˜¯ Object ç±»å‹ï¼Œå…¶ä¸­çš„ key å¯¹åº” AST ä¸­çš„å„ä¸ªèŠ‚ç‚¹çš„ typeï¼Œ<code>path.node</code> æ˜¯ AST ä¸­çš„èŠ‚ç‚¹æ•°æ®ã€‚</p>\n<p>ç®€å•äº†è§£ visitor åï¼Œå¼€å§‹æˆ‘ä»¬çš„å¼€å‘å§ï¼</p>\n<h4 id="å¾—åˆ°-imported-å˜é‡åé›†åˆ"><a href="#%E5%BE%97%E5%88%B0-imported-%E5%8F%98%E9%87%8F%E5%90%8D%E9%9B%86%E5%90%88" aria-hidden="true"><span class="icon icon-link"></span></a>å¾—åˆ° imported å˜é‡åé›†åˆ</h4>\n<p>æˆ‘ä»¬éœ€è¦å…³å¿ƒ <code>import</code> è¯­å¥æœ‰ï¼š</p>\n<pre><code class="hljs language-javascript" data-query="{}" data-lang="javascript"><span class="hljs-keyword">import</span> lodash <span class="hljs-keyword">from</span> <span class="hljs-string">\'loadsh\'</span>\n<span class="hljs-keyword">import</span> { extend, cloneDeep <span class="hljs-keyword">as</span> clone } <span class="hljs-keyword">from</span> <span class="hljs-string">\'lodash\'</span></code></pre>\n<p>è€Œå¯¹äº <code>import \'babel-polyfill\'</code> è¯­å¥ï¼Œåˆ™ä¸å…³å¿ƒã€‚</p>\n<p>ä»¥ <code>import { extend, cloneDeep as clone } from \'lodash\'</code> ä¸ºä¾‹ï¼Œå¾—åˆ°çš„ AST ä¸ºï¼š\n<img src="http://obu9je6ng.bkt.clouddn.com/FmoMJFEwtRgN9pPLZeQW2-wmuFC-?imageslim" width="475" height="329"/></p>\n<p>å…¶ä¸­çš„æ•°ç»„ <code>specifiers</code> ä¸ºï¼š\n<img src="https://i.loli.net/2017/11/30/5a201ece80d93.jpg" width="356" height="505"/></p>\n<p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å¾—åˆ° <code>specifiers</code> ä¸­çš„ <code>local.name</code> å³å¯ï¼Œå•ä¸ºäº†åç»­å¯¹è¯¥ AST ç»“ç‚¹è¿›è¡Œæ“ä½œ(åˆ é™¤)ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦å­˜å‚¨ç»“ç‚¹ä¿¡æ¯ï¼Œå¦‚ä¸‹ä»£ç ï¼š</p>\n<pre><code class="hljs language-javascript" data-query="{}" data-lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSpecifierIdentifiers</span>(<span class="hljs-params">specifiers = [], withPath = false</span>) </span>{\n  <span class="hljs-keyword">const</span> collection = []\n  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loop</span>(<span class="hljs-params">path, index</span>) </span>{\n    <span class="hljs-keyword">const</span> node = path.node\n    <span class="hljs-keyword">const</span> item = { path, <span class="hljs-attr">name</span>: node.local.name }\n    <span class="hljs-keyword">switch</span> (node.type) {\n      <span class="hljs-keyword">case</span> <span class="hljs-string">\'ImportDefaultSpecifier\'</span>:\n      <span class="hljs-keyword">case</span> <span class="hljs-string">\'ImportSpecifier\'</span>:\n        collection.push(item)\n        <span class="hljs-keyword">break</span>;\n    }\n  }\n  specifiers.forEach(loop)\n\n  <span class="hljs-keyword">return</span> collection\n}</code></pre>\n<p>ä»¥ä¸Šä»£ç å°†è¿”å› </p>\n<pre><code class="hljs language-javascript" data-query="{}" data-lang="javascript">[\n  { <span class="hljs-attr">path</span>: NodePath, <span class="hljs-attr">name</span>: <span class="hljs-string">\'extend\'</span> },\n  { <span class="hljs-attr">path</span>: NodePath, <span class="hljs-attr">name</span>: <span class="hljs-string">\'clone\'</span> }\n]</code></pre>\n<p>å¾—åˆ°è¯¥æ¡ <code>import</code> è¯­å¥çš„å¼•å…¥çš„å˜é‡æ•°ç»„åï¼Œè¿˜éœ€è¦å­˜å‚¨ä¸€ä»½ <code>import</code> è¯­å¥çš„ NodePathï¼Œä¸ºäº†åç»­æ“ä½œ(åˆ é™¤)</p>\n<pre><code class="hljs language-javascript" data-query="{}" data-lang="javascript">{\n  <span class="hljs-string">\'extend\'</span>: {\n    <span class="hljs-attr">parent</span>: path, <span class="hljs-comment">// `import` è¯­å¥çš„ NodePath</span>\n    children: [\n      { <span class="hljs-attr">path</span>: NodePath, <span class="hljs-attr">name</span>: <span class="hljs-string">\'extend\'</span> },\n      { <span class="hljs-attr">path</span>: NodePath, <span class="hljs-attr">name</span>: <span class="hljs-string">\'clone\'</span> }\n    ],\n    <span class="hljs-attr">data</span>: { <span class="hljs-attr">path</span>: NodePath, <span class="hljs-attr">name</span>: <span class="hljs-string">\'extend\'</span> }\n  },\n  <span class="hljs-string">\'clone\'</span>: {\n    <span class="hljs-attr">parent</span>: path,\n    <span class="hljs-attr">children</span>: [\n      { <span class="hljs-attr">path</span>: NodePath, <span class="hljs-attr">name</span>: <span class="hljs-string">\'extend\'</span> },\n      { <span class="hljs-attr">path</span>: NodePath, <span class="hljs-attr">name</span>: <span class="hljs-string">\'clone\'</span> }\n    ],\n    <span class="hljs-attr">data</span>: { <span class="hljs-attr">path</span>: NodePath, <span class="hljs-attr">name</span>: <span class="hljs-string">\'clone\'</span> }\n  }\n}</code></pre>\n<h4 id="å»é™¤ä½¿ç”¨è¿‡çš„-imported-å˜é‡å"><a href="#%E5%8E%BB%E9%99%A4%E4%BD%BF%E7%94%A8%E8%BF%87%E7%9A%84-imported-%E5%8F%98%E9%87%8F%E5%90%8D" aria-hidden="true"><span class="icon icon-link"></span></a>å»é™¤ä½¿ç”¨è¿‡çš„ imported å˜é‡å</h4>\n<p>åœ¨å»é™¤ä½¿ç”¨è¿‡çš„ imported å˜é‡åä¹‹å‰ï¼Œéœ€è¦æ˜ç¡®ä¸€ç‚¹ï¼š<br>\nåœ¨ ES6 æ ‡å‡†ä¸­ï¼Œimport ä¸­å®šä¹‰çš„å˜é‡åæ˜¯ä¸èƒ½è¢«é‡æ–°å®šä¹‰çš„ï¼Œå¦‚ä¸‹ä»£ç æ˜¯ä¸è¢«å…è®¸çš„ã€‚</p>\n<pre><code class="hljs language-javascript" data-query="{}" data-lang="javascript"><span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">\'lodash\'</span>\n<span class="hljs-keyword">const</span> _ = <span class="hljs-string">\'hello\'</span></code></pre>\n<p>é‚£ä¹ˆä»€ä¹ˆæƒ…å†µä¸‹ <code>extend</code> æ˜¯è¢«ä½¿ç”¨çš„å‘¢ï¼Ÿ</p>\n<pre><code class="hljs language-javascript" data-query="{}" data-lang="javascript">extend = <span class="hljs-string">\'extend\'</span>\n[ extend ]\n{ <span class="hljs-attr">key</span>: extend }\nextend - <span class="hljs-number">2</span>\nextend / <span class="hljs-number">2</span>\nextend > <span class="hljs-number">2</span>\nextend &#x3C;= <span class="hljs-number">2</span>\nextend[<span class="hljs-string">\'key\'</span>]()\nextend.key = <span class="hljs-number">233</span>\nextend.key > <span class="hljs-number">233</span>\n&#x3C;extend />\n<span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">A</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{extend}</span> /></span>\n// ...</span></code></pre>\n<p>æƒ…å†µå¤ªå¤šäº† ğŸ˜¢\næ—¢ç„¶æ­£é¢åˆ—ä¸¾è¢«ä½¿ç”¨çš„æƒ…å†µæ¯”è¾ƒå¤æ‚ï¼Œé‚£ä½•ä¸é€†å‘æ€ç»´ï¼Œè€ƒè™‘ <code>extend</code> æ²¡è¢«ä½¿ç”¨çš„æƒ…å†µå‘¢ï¼Ÿ</p>\n<pre><code class="hljs language-javascript" data-query="{}" data-lang="javascript"><span class="hljs-keyword">const</span> extend = <span class="hljs-string">\'value\'</span>\n{ <span class="hljs-attr">extend</span>: <span class="hljs-string">\'value\'</span> }\nref.extend\n<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>{ \n  extend() {}\n  extend = <span class="hljs-number">233</span>\n}\n&#x3C;Component extend={<span class="hljs-number">233</span>} /></code></pre>\n<p>æœç„¶æƒ…å†µå°±å¥½å¤šäº†å˜› ğŸ˜„</p>\n<p>äºæ˜¯ï¼Œå»é™¤ä½¿ç”¨è¿‡çš„ imported å˜é‡åä¹Ÿå¯ä»¥æ¬¢å¿«åœ°å®Œæˆå•¦ï¼</p>\n<h4 id="ç§»é™¤æ²¡æœ‰ä½¿ç”¨åˆ°çš„-import--è¯­å¥"><a href="#%E7%A7%BB%E9%99%A4%E6%B2%A1%E6%9C%89%E4%BD%BF%E7%94%A8%E5%88%B0%E7%9A%84-import--%E8%AF%AD%E5%8F%A5" aria-hidden="true"><span class="icon icon-link"></span></a>ç§»é™¤æ²¡æœ‰ä½¿ç”¨åˆ°çš„ <code>import ...</code> è¯­å¥</h4>\n<ol>\n<li>éå†æœ€ç»ˆå¾—åˆ°çš„æ²¡æœ‰ä½¿ç”¨åˆ°å˜é‡é›†åˆ Aï¼›</li>\n<li>å¦‚æœ item ä¸­çš„ <code>children</code> ä¸­æ¯ä¸€ä¸ª <code>name</code> éƒ½å­˜åœ¨äº A ä¸­ï¼Œåˆ é™¤ <code>item.parent</code> ç»“ç‚¹ï¼Œå¦åˆ™åªåˆ é™¤ <code>item.data.path</code> ç»“ç‚¹ï¼›</li>\n</ol>\n<h3 id="æ‰“å®Œæ”¶å·¥ï¼"><a href="#%E6%89%93%E5%AE%8C%E6%94%B6%E5%B7%A5%EF%BC%81" aria-hidden="true"><span class="icon icon-link"></span></a>æ‰“å®Œæ”¶å·¥ï¼</h3>\n<p>å®Œæˆäº†ä¸Šé¢ä¸€ç³»åˆ—çš„åˆ†æåï¼Œå¾—åˆ°çš„æœ€ç»ˆæ’ä»¶ä»£ç å¤§æ¦‚è¿™ä¸ªæ ·å­ï¼š</p>\n<pre><code class="hljs language-javascript" data-query="{}" data-lang="javascript"><span class="hljs-built_in">module</span>.exports = {\n  pre() {\n    <span class="hljs-keyword">this</span>.runtimeData = {}\n  }\n  visitor: {\n    ImportDeclaration(path, data) {\n      <span class="hljs-keyword">const</span> locals = getSpecImport(path);\n      <span class="hljs-keyword">if</span> (locals) {\n        locals.forEach(<span class="hljs-function">(<span class="hljs-params">pathData, index, all</span>) =></span> {\n          <span class="hljs-keyword">const</span> {name} = pathData\n          <span class="hljs-keyword">this</span>.runtimeData[name] = {\n            <span class="hljs-attr">parent</span>: path,\n            <span class="hljs-attr">children</span>: all,\n            <span class="hljs-attr">data</span>: pathData\n          }\n        })\n        <span class="hljs-comment">// è·³è¿‡å½“å‰pathçš„å­èŠ‚ç‚¹çš„å‘ä¸‹éå†</span>\n        <span class="hljs-comment">// ä¸ºäº†é˜²æ­¢éå† import è¯­å¥ä¸­çš„ Identifier</span>\n        path.skip()\n      }\n    },\n    Identifier() {\n      <span class="hljs-comment">// ä¹¦å†™æ­¥éª¤2é€»è¾‘ï¼Œåˆ é™¤ä½¿ç”¨è¿‡çš„Identifier</span>\n    },\n    JSXIdentifier() {\n      <span class="hljs-comment">// ä¹¦å†™æ­¥éª¤2é€»è¾‘ï¼Œåˆ é™¤ä½¿ç”¨è¿‡çš„Identifier  </span>\n    }\n  },\n  post() {\n    <span class="hljs-comment">// ä¹¦å†™æ­¥éª¤3é€»è¾‘</span>\n    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.runtimeData\n  }\n}</code></pre>\n<p>ä»¥ä¸Šä»£ç å’‹çœ‹ä¸€ä¸‹é€»è¾‘çš„ç¡®æ²¡é—®é¢˜ã€‚<br>\n<strong>ä½†æ˜¯ï¼</strong>æ­é…<code>preset-es2015</code>ä½¿ç”¨æ—¶ï¼Œå°†ä¼šä¸èƒ½æ­£ç¡®åˆ é™¤æœªä½¿ç”¨çš„å˜é‡åæˆ–è€… import è¯­å¥ã€‚<br>\næŠ¥é”™ï¼š<code>NodePath has been removed so is read-only.</code>\nå› ä¸º es2015 ä¸­ä¼šå°† import è¯­å¥è¿›è¡Œæ›¿æ¢ï¼Œç›¸å½“äºå­˜å‚¨çš„ NodePath å·²ç»è¢«åˆ é™¤äº†ã€‚</p>\n<p>å…³äºBabelä¸­pluginå’Œpresetçš„æ‰§è¡Œé¡ºåºï¼Œå®˜æ–¹çš„è§£é‡Šå¦‚ä¸‹ï¼š</p>\n<blockquote>\n<p>Plugins run before Presets.<br>\nPlugin ordering is first to last.<br>\nPreset ordering is reversed (last to first).</p>\n</blockquote>\n<p>æ—¢ç„¶ Plugins run before Presetsï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰ä¸Šè¯‰çš„é—®é¢˜å‘¢ï¼Ÿ</p>\n<p>Babelçš„æ ¸å¿ƒå¼€å‘äººå‘˜ @hzoo åšå‡ºä¸‹åˆ—è§£é‡Š:</p>\n<blockquote>\n<p>Plugins do go before presets, but it just adds the same visitors first before merging them.</p>\n</blockquote>\n<p>æ„æ€æ˜¯ï¼ŒBabel åœ¨å¤„ç† plugins çš„æ—¶å€™ï¼Œä¼šå°† visitor é‡Œé¢å„ä¸ªå¯¹åº”çš„å•å…ƒç»Ÿä¸€åˆå¹¶ï¼Œç„¶åå†æŒ‰ç…§æ’ä»¶çš„é¡ºåºå»æ‰§è¡Œã€‚</p>\n<img src="http://obu9je6ng.bkt.clouddn.com/FmNs17OZT1JSki4bVtVQ0Tepxk5P?imageslim" width="501" height="139"/>\n<p>æ‰€ä»¥åœ¨æ‰§è¡Œåˆ° post() æ–¹æ³•æ—¶ï¼Œå…¶å®es2015ä¸­çš„æ’ä»¶å·²ç»å°† import è¯­å¥æ›¿æ¢äº† ğŸ˜¢</p>\n<p>é‚£ä¹ˆè¯¥é—®é¢˜å¦‚ä½•è§£å†³å‘¢ï¼Ÿ<br>\nå¯ä»¥ AST æœ€å¤–å±‚çš„ Program ç»“ç‚¹éå† pathï¼Œé€»è¾‘åŒä¸Šã€‚</p>\n<p>æœ€ç»ˆä»£ç ä¸ºï¼š</p>\n<pre><code class="hljs language-javascript" data-query="{}" data-lang="javascript"><span class="hljs-keyword">const</span> traverseObject = {\n  ImportDeclaration(path, data) {\n    <span class="hljs-comment">// ...</span>\n  },\n  Identifier() {\n    <span class="hljs-comment">// ...</span>\n  }\n  JSXIdentifier() {\n    <span class="hljs-comment">// ...</span>\n  }\n}\n\n<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">babel</span>) </span>{\n  <span class="hljs-keyword">return</span> {\n    pre(path) {\n      <span class="hljs-keyword">this</span>.runtimeData = {}\n    },\n    <span class="hljs-attr">visitor</span>: {\n      Program(path, data) {\n        <span class="hljs-comment">// åœ¨æœ€å¤–å±‚çš„ Program éå† path</span>\n        path.traverse(traverseObject, {\n          <span class="hljs-attr">runtimeData</span>: <span class="hljs-keyword">this</span>.runtimeData\n        })\n        handleRemovePath(<span class="hljs-keyword">this</span>.runtimeData)\n      }\n    },\n    post() {\n      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.runtimeData\n    }\n  }\n}</code></pre>\n<p>æºç ï¼š<a href="https://github.com/imcuttle/babel-plugin-danger-remove-unused-import">GitHubğŸ‘</a></p>\n<h2 id="å‚è€ƒèµ„æ–™"><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" aria-hidden="true"><span class="icon icon-link"></span></a>å‚è€ƒèµ„æ–™</h2>\n<ul>\n<li><a href="https://github.com/babel/babel/issues/5623">Discussion: Fix Plugin Ordering #5623</a>  </li>\n<li><a href="https://github.com/thejameskyle/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md">babel handbook</a></li>\n</ul>\n',extra:{}}}});